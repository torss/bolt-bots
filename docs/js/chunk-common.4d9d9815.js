(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-common"],{0:function(e,t){},"028a":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("7796");class i{constructor(){this.card=void 0,this.active=!1}invoke(e){return!!this.card&&(this.active=!0,this.card.invoke(e),!0)}clear(){this.card=void 0,this.active=!1}serialize(){return{card:this.card&&this.card.serialize()}}deserialize(e){return e.card?this.card=(new n["a"]).deserialize(e.card):this.card=void 0,this}}},"0313":function(e,t,r){"use strict";var n=r("5a89");n["Vector3"].prototype.pushOnto=function(e){e.push(this.x,this.y,this.z)},n["Vector3"].prototype.addScalars=function(e,t,r){return this.x+=e,this.y+=t,this.z+=r,this},n["Vector3"].prototype.multiplyScalars=function(e,t,r){return this.x*=e,this.y*=t,this.z*=r,this},n["Vector3"].prototype.applyFunction=function(e){return this.x=e({vector:this,value:this.x,axis:"x",index:0}),this.y=e({vector:this,value:this.y,axis:"y",index:1}),this.z=e({vector:this,value:this.z,axis:"z",index:2}),this},n["Vector3"].prototype.swapTwoAxes=function(e,t){const r=this[e];return this[e]=this[t],this[t]=r,this},n["Vector3"].prototype.swizzle=function(e,t,r){const n=this[e],i=this[t],s=this[r];return this.x=n,this.y=i,this.z=s,this},n["Vector3"].prototype.isWithinOriginCube=function(e){return this.x<=e&&this.x>=-e&&this.y<=e&&this.y>=-e&&this.z<=e&&this.z>=-e},n["Vector3"].prototype.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},n["Vector3"].prototype.redivScalar=function(e=1){return this.x=e/this.x,this.y=e/this.y,this.z=e/this.z,this},n["Vector3"].prototype.rsub=function(e){return this.x=e.x-this.x,this.y=e.y-this.y,this.z=e.z-this.z,this},n["Vector3"].prototype.iterXyz=function(e){const{x:t,y:r,z:n}=this;for(this.z=0;this.z<n;++this.z)for(this.y=0;this.y<r;++this.y)for(this.x=0;this.x<t;++this.x)e(this);return this},n["Vector3"].prototype.serialize=function(){const{x:e,y:t,z:r}=this;return{x:e,y:t,z:r}},n["Matrix3"].prototype.makeRotationFromEuler=function(e){const t=this.elements,r=e.x,n=e.y,i=e.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(n),c=Math.sin(n),h=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){const e=s*h,r=s*l,n=o*h,i=o*l;t[0]=a*h,t[3]=-a*l,t[6]=c,t[1]=r+n*c,t[4]=e-i*c,t[7]=-o*a,t[2]=i-e*c,t[5]=n+r*c,t[8]=s*a}else if("YXZ"===e.order){const e=a*h,r=a*l,n=c*h,i=c*l;t[0]=e+i*o,t[3]=n*o-r,t[6]=s*c,t[1]=s*l,t[4]=s*h,t[7]=-o,t[2]=r*o-n,t[5]=i+e*o,t[8]=s*a}else if("ZXY"===e.order){const e=a*h,r=a*l,n=c*h,i=c*l;t[0]=e-i*o,t[3]=-s*l,t[6]=n+r*o,t[1]=r+n*o,t[4]=s*h,t[7]=i-e*o,t[2]=-s*c,t[5]=o,t[8]=s*a}else if("ZYX"===e.order){const e=s*h,r=s*l,n=o*h,i=o*l;t[0]=a*h,t[3]=n*c-r,t[6]=e*c+i,t[1]=a*l,t[4]=i*c+e,t[7]=r*c-n,t[2]=-c,t[5]=o*a,t[8]=s*a}else if("YZX"===e.order){const e=s*a,r=s*c,n=o*a,i=o*c;t[0]=a*h,t[3]=i-e*l,t[6]=n*l+r,t[1]=l,t[4]=s*h,t[7]=-o*h,t[2]=-c*h,t[5]=r*l+n,t[8]=e-i*l}else if("XZY"===e.order){const e=s*a,r=s*c,n=o*a,i=o*c;t[0]=a*h,t[3]=-l,t[6]=c*h,t[1]=e*l+i,t[4]=s*h,t[7]=r*l-n,t[2]=n*l-r,t[5]=o*h,t[8]=i*l+e}return this},n["Matrix3"].prototype.makeRotationFromQuaternion=function(e,t){const r=this.elements,n=e._x,i=e._y,s=e._z,o=e._w,a=n+n,c=i+i,h=s+s,l=n*a,u=n*c,d=n*h,p=i*c,m=i*h,f=s*h,y=o*a,g=o*c,v=o*h;let b,x,w;return t?(b=t.x,x=t.y,w=t.z):b=x=w=1,r[0]=(1-(p+f))*b,r[1]=(u+v)*b,r[2]=(d-g)*b,r[3]=(u-v)*x,r[4]=(1-(l+f))*x,r[5]=(m+y)*x,r[6]=(d+g)*w,r[7]=(m-y)*w,r[8]=(1-(l+p))*w,this};r("d014");n["Camera"].prototype.getWorldNormals=function(e=new n["Vector3"],t=new n["Vector3"],r=new n["Vector3"]){this.updateMatrixWorld(!0);const i=this.matrixWorld.elements;return e.set(i[0],i[1],i[2]).normalize(),t.set(i[4],i[5],i[6]).normalize(),r.set(-i[8],-i[9],-i[10]).normalize(),{up:e,side:t,direction:r}};r("6291");function i(e,t,r,n,i){if(e.itemSize!==t)throw new TypeError("BufferAttributeExt: Can't use "+r+" since itemSize !== "+t);e.padSize(e.countCurrent+n.length);for(let s=0;s<n.length;++s)i(n[s]);return e}n["BufferAttribute"].prototype.resize=function(e){if(e===this.count)return;const t=e*this.itemSize;let r;return e<this.count?r=this.array.slice(0,t):(r=new this.array.constructor(t),r.set(this.array)),this.array=r,this.count=e,this};class s extends n["BufferAttribute"]{constructor(e,t,r){super(e,t,r),this.countCurrent=this.count,this.indexCurrent=this.array.length}clear(e=!0){return e&&this.resize(0),this.countCurrent=0,this.indexCurrent=0,this}padSize(e){return this.countCurrent=e,this.count<this.countCurrent&&this.resize(Math.nextPowerOfTwo(this.countCurrent)),this}fitSize(e=!0){return this.resize(this.countCurrent),this.indexCurrent=this.countCurrent*this.itemSize,e&&(this.needsUpdate=!0),this}pushScalar(...e){return i(this,1,"pushScalar",e,e=>{this.array[this.indexCurrent++]=e})}pushVector2(...e){return i(this,2,"pushVector2",e,e=>{this.array[this.indexCurrent++]=e.x,this.array[this.indexCurrent++]=e.y})}upushVector3(...e){for(let t=0;t<e.length;++t){const r=e[t];this.array[this.indexCurrent++]=r.x,this.array[this.indexCurrent++]=r.y,this.array[this.indexCurrent++]=r.z}}upushVector4(...e){for(let t=0;t<e.length;++t){const r=e[t];this.array[this.indexCurrent++]=r.x,this.array[this.indexCurrent++]=r.y,this.array[this.indexCurrent++]=r.z,this.array[this.indexCurrent++]=r.w}}pushVector3(...e){this.padSize(this.countCurrent+e.length),this.upushVector3(...e)}pushVector3proto(e){this.count<++this.countCurrent&&this.resize(Math.nextPowerOfTwo(this.countCurrent)),this.array[this.indexCurrent++]=e.x,this.array[this.indexCurrent++]=e.y,this.array[this.indexCurrent++]=e.z}}class o extends s{constructor(e=new Uint16Array){super(e,1),this.highestStoredIndex=-1}fitSize(){const e=this.array instanceof Uint32Array,t=this.highestStoredIndex>65535;return e&&!t?(this.array=new Uint16Array(this.array.subarray(0,this.countCurrent)),this.count=this.countCurrent,this.indexCurrent=this.countCurrent*this.itemSize):super.fitSize(),this}pushWithOffset(e,...t){let r=this.array instanceof Uint32Array;return i(this,1,"pushVector3",t,t=>{if(t+=e,!r){const e=t>65535;e&&(this.array=new Uint32Array(this.array),r=!0)}this.array[this.indexCurrent++]=t,this.highestStoredIndex<t&&(this.highestStoredIndex=t)})}pushRelative(...e){return this.pushWithOffset(this.highestStoredIndex+1,...e)}pushRelativeWithOffset(e,...t){return this.pushWithOffset(e+this.highestStoredIndex+1,...t)}}r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}))},2:function(e,t){},3:function(e,t){},"346e":function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return c}));var n=r("5a89"),i=r("34ad");class s{constructor(e,t,r){this.path=e,this.name=t,this.status="unprocessed",this.loadedFunc=r,this.result=void 0}}class o extends s{get loaderKey(){return"gltfLoader"}get gltf(){return"done"===this.status?this.result:void 0}}o.loaderKey="gltfLoader";class a extends s{get loaderKey(){return"fontLoader"}get font(){return"done"===this.status?this.result:void 0}}class c{constructor(e=[],t){this.items=e,this.countDone=0,this.countError=0,this.gltfLoader=new i["a"],this.fontLoader=new n["FontLoader"],this.allDoneFunc=t}get countTotal(){return this.countDone+this.countError}start(){for(const e of this.items)if("unprocessed"===e.status){e.status="loading";const t=this[e.loaderKey];t.load(e.path,t=>{++this.countDone,e.status="done",e.result=t,e.loadedFunc&&e.loadedFunc(e,this),this.allDoneFunc&&(this.countDone===this.items.length?this.allDoneFunc(!0,this):this.countTotal===this.items.length&&this.allDoneFunc(!1,this))},void 0,t=>{++this.countError,e.status="error",e.result=t})}}}},"3b8b":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("682a"),i=r("5a89");r("0313");class s{constructor(e){this.game=e,this.defaultVolume=1}get audioListener(){return this.game.audioListener}get context(){return this.audioListener.context}createPrimitve(e,t){const r=this.context.createGain();r.gain.value=0;const n=this.context.createOscillator();return n.type=e,n.frequency.value=t,n.connect(r),n.start(),{gain:r,oscillator:n}}createTween(e,t,r,i,s,o){void 0===o&&(o=this.defaultVolume);const{gain:a,oscillator:c}=this.createPrimitve(e,t);let h=0;const l={p:0},u=new n["Tween"](l).to({p:1},0).delay(i).repeat(s).onUpdate(()=>{c.frequency.value=t+l.p*h*r,a.gain.value=o*(1-h/s),++h});return{gain:a,oscillator:c,tween:u}}createPosAudio(e,t,r,n,s,o){const{gain:a,oscillator:c,tween:h}=this.createTween(e,t,r,n,s,o),l=new i["PositionalAudio"](this.audioListener);return l.setNodeSource(a),h.onComplete(()=>{c.stop(),l.removeSelf()}),{posAudio:l,tween:h,oscillator:c}}createPosAudioStarted(e,t,r,n,i,s){const{posAudio:o,tween:a}=this.createPosAudio(e,t,r,n,i,s);return a.start(),o}cpasShoot(){const e=this.createPosAudioStarted("square",200,10,20,10);return e.add(this.createPosAudioStarted("sawtooth",300,-40,40,10)),e.add(this.createPosAudioStarted("square",2e3,-200,40,10)),e}cpasHit(){const e=this.createPosAudioStarted("square",200,-8,10,20);return e.add(this.createPosAudioStarted("sawtooth",80,-4,10,25)),e.add(this.createPosAudioStarted("square",100,15,5,20)),e.add(this.createPosAudioStarted("square",180,-10,10,40)),e}cpasShove(){return this.createPosAudioStarted("square",150,-15,30,15)}cpasCrush(){return this.createPosAudioStarted("sawtooth",150,-15,30,15,2)}cpasExplode(){const e=1.5,t=3,r=1,n=this.createPosAudioStarted("sawtooth",200,-8/t,10,15*t);return n.add(this.createPosAudioStarted("sawtooth",80,-4/t,10,15*t)),n.add(this.createPosAudioStarted("sawtooth",100,15/t,5,10*t)),n.add(this.createPosAudioStarted("sawtooth",180,-10/t,10,20*t)),n.add(this.createPosAudioStarted("triangle",10,1/r,100,10*r,e)),n.add(this.createPosAudioStarted("square",100,-10/r,100,10*r,e)),n.add(this.createPosAudioStarted("sine",100,-10/r,100,10*r,e)),n}cpasCheckpoint(){const e=this.createPosAudioStarted("square",200,10,40,30);return e.add(this.createPosAudioStarted("sawtooth",300,-40,40,10)),e.add(this.createPosAudioStarted("sine",1e3,-200,40,10)),e}cpasEndTurn(){return this.createPosAudioStarted("sine",100,10,5,30)}}},"3dcd":function(e,t){Number.prototype.mod=function(e){return(this%e+e)%e}},4:function(e,t){},"43b4":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const n={name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},i={name:"RSA-PSS",saltLength:32}},"49ca":function(e,t,r){"use strict";r("b217");var n=r("7796"),i=r("028a"),s=r("5a89"),o=r("682a");class a{constructor(e,t,r){this.game=e,this.number=t;const n=new s["TextGeometry"](t.toString(),{font:e.fonts["Default"],size:.5,height:.15}),i=new s["Mesh"](n,new s["MeshBasicMaterial"]({color:new s["Color"](.03,.03,1)}));this.tween=new o["Tween"](i.material.color).to(new s["Color"](.1,.1,1),1e3).delay(250*(t-1)).repeatDelay(250*e.match.checkpointCount).easing(o["Easing"].Quartic.Out).repeat(1/0).yoyo(!0).start(),i.rotateX(-.5*Math.PI),i.bloom=!0,this.object3d=i,this.setPosition(r),e.scene.add(i)}destroy(){this.tween.stop(),this.object3d.removeSelf()}setPosition(e){this.object3d.position.copy(e).add(new s["Vector3"](-.2,-.35,.25)),this.checkPosition=(new s["Vector3"]).copy(e)}serialize(){const{number:e,checkPosition:t}=this;return{number:e,checkPosition:t.serialize()}}static deserializeNew(e,t){const{number:r,checkPosition:n}=t;return new a(e,r,(new s["Vector3"]).copy(n))}}var c=r("c380"),h=r("fd7d"),l=r("43b4");class u{constructor(e,t,r){this.id=t,this.name=r,this.alive=!0,this.killedInTurn=-1,this.killedBy=[],this.icon="robot",this.completedCheckpoints=0,this.netKey="",this.pnid="",this.left=!1,this.endTurn=!1,this.completeTurn=!1,this.lastPingTimeout=!1,Object(h["a"])(this),this.game=e,this.hand=[],this.bot=new c["a"](e,this),this.lastPing=Date.now(),this.hostVote=void 0,this.cryptoKeySvPublicEx=void 0,this.cryptoKeySvPublic=void 0}async cryptoKeySvPublicLoad(e){this.cryptoKeySvPublicEx=e,this.cryptoKeySvPublic=await crypto.subtle.importKey("jwk",e,l["a"],!1,["verify"])}markAsDead(e){if(this.killedBy.includes(e)||this.killedBy.push(e),this.alive){this.alive=!1;const e=["ghost","grave-stone","halloween","nuke","fire","skull","skull-crossbones","skull-outline","skull-crossbones-outline","bone","emoticon-dead","emoticon-dead-outline","trash-can","trash-can-outline","sleep"];this.icon=e[Math.round(e.length*this.game.match.rngCosmetic.nextNumber())];const t=this.game.match;this.killedInTurn=t.turn;const r=t.turnPlayers.indexOf(this);return r>=0&&t.turnPlayers.splice(r,1),t.deadPlayers.push(this),!0}return!1}win(e){const t=this.game.match;t.gameOver=e,t.victors.push(this)}destroy(){this.bot.destroy()}serialize(e=!1){const{id:t,name:r,netKey:n,pnid:i,hand:s,bot:o,killedInTurn:a,killedBy:c,completedCheckpoints:h,lastPing:l,cryptoKeySvPublicEx:u,left:d}=this;let p={id:t,name:r,netKey:n,pnid:i,cryptoKeySvPublicEx:u,left:d};return e&&(p.hand=s.map(e=>e.serialize()),p.bot=o.serialize(),p.killedBy=c.map(e=>e.id),p={...p,killedInTurn:a,completedCheckpoints:h,lastPing:l}),p}deserialize(e){const{id:t,name:r,netKey:i,pnid:s,left:o,hand:a,bot:c,killedInTurn:h,completedCheckpoints:l,lastPing:u,cryptoKeySvPublicEx:d}=e;void 0!==t&&(this.id=t),void 0!==r&&(this.name=r),void 0!==i&&(this.netKey=i),void 0!==s&&(this.pnid=s),void 0!==o&&(this.left=o),void 0!==a&&(this.hand=a.map(e=>new n["a"](e).deserialize(e))),void 0!==c&&this.bot.deserialize(c),void 0!==h&&(this.killedInTurn=h,this.alive=h<1),void 0!==l&&(this.completedCheckpoints=l),void 0!==u&&(this.lastPing=u),void 0!==d&&this.cryptoKeySvPublicLoad(d)}}class d{constructor(){Object(h["a"])(this),this.position=new s["Vector3"]}}var p=r("ac93"),m=r("36c1"),f=r.n(m);class y extends f.a{choose(e){return Math.floor(this.nextNumber()*e)}chooseFrom(e){return e[this.choose(e.length)]}clone(){return new y(this.lowSeed,this.highSeed)}serialize(){return this.saveRngStates()}deserialize(e){this.loadRngStates(...e)}}class g{constructor(e){this.players=[],this.turnPlayers=[],this.deadPlayers=[],this.playerSelf=void 0,this.turn=1,this.turnInProgress=!1,this.gameOver=!1,this.gameOverQuip=0,this.victors=[],this.handSize=8,this.damageLazor=.2,this.damageShove=.05,this.damageCrush=.15,this.turnCardIndex=-1,Object(h["a"])(this),this.game=e,this.mapGen=void 0,this.map=void 0,this.openTileCount=0,this.checkpointCount=3,this.slotCount=5,this.turnPlayerIndex=0,this.remainingActionCount=0,this.controlTower=new d,this.checkpoints=[],this.actionType="lazor",this.endTurn=!1,this.rng=new y(0,0),this.rngMapGen=new y(0,0),this.rngCosmetic=new y(0,0),this.rngPlaceBots=new y(0,0)}get turnPlayer(){return this.turnPlayers[this.turnPlayerIndex]}startTurn(){this.turnInProgress=!0,this.turnPlayers=this.players.filter(e=>e.alive),this.turnCardIndex=0,this.turnPlayerIndex=-1,this.prepareTurnPlayers(),this.progressTurn()}completeTurn(){for(const e of this.turnPlayers){e.bot.clearCardSlots();for(let t=e.hand.length;t<this.handSize;++t){const t=p["a"][Math.floor(this.rng.nextNumber()*p["a"].length)];e.hand.push(new n["a"](t))}}this.turnCardIndex=-1,this.turnPlayerIndex=-1,0===this.turnPlayers.length?this.gameOver="draw":1===this.turnPlayers.length&&(this.gameOver="lms",this.victors=[this.turnPlayers[0]]),this.gameOver||++this.turn,this.gameOverQuip=this.rngCosmetic.nextNumber(),this.game.completeTurn()}prepareTurnPlayers(){this.turnPlayers.sort((e,t)=>Math.abs(e.bot.towerDistance-t.bot.towerDistance)<Number.EPSILON?e.netKey.localeCompare(t.netKey):e.bot.towerDistance-t.bot.towerDistance)}actionDone(){if(--this.remainingActionCount,0===this.remainingActionCount)switch(this.actionType){case"lazor":this.actionType="conveyor",this.turnPlayerIndex=-1,this.remainingActionCount=1,this.actionDone();break;case"conveyor":++this.turnPlayerIndex,this.remainingActionCount=1,this.turnPlayer?this.turnPlayer.bot.conveyor():this.progressTurnNextCardSlot();break;default:console.error("Match::actionDone - Unknown actionType:",this.actionType),this.progressTurnNextCardSlot();break}}progressTurnNextCardSlot(){++this.turnCardIndex,this.turnPlayerIndex=-1,this.prepareTurnPlayers(),this.progressTurn()}progressTurn(){if(0===this.turnPlayers.length||this.gameOver)this.completeTurn();else while(1){if(++this.turnPlayerIndex,this.turnPlayer){let e=!1;while(this.turnPlayer){const t=this.turnPlayer.bot;if(t.invokeCardSlot(this.turnCardIndex))return;this.turnCardIndex<t.cardSlots.length&&(e=!0),++this.turnPlayerIndex}if(e)continue;return void this.completeTurn()}if(this.turnPlayers.length>0){this.actionType="lazor",this.remainingActionCount=this.turnPlayers.length;for(const e of this.turnPlayers)e.bot.shoot();return}this.progressTurnNextCardSlot()}}setRngSeed(e){const t=()=>new y(e[0],e[1]);this.rng=t(),this.rngMapGen=t(),this.rngCosmetic=t(),this.rngPlaceBots=this.rngMapGen.clone()}setRngSeedStr(e){const t=[0,0];for(let r=0;r<e.length;++r)t[r%2]+=e.charCodeAt(r);this.setRngSeed(t)}isTileOpen(e){return!e.tiTy.wall&&!e.special}destroyPlayers(){const e=this;for(const t of e.players)t.destroy();e.players=[],e.turnPlayers=[],e.deadPlayers=[]}regenerateMap(){const e=this;e.map&&e.map.destroy(),e.map=void 0;for(const i of e.checkpoints)i.object3d.removeSelf();e.checkpoints=[];const t=e.game,{map:r,controlTowerTilePosition:n}=e.mapGen.func(t);r.tiMa.materials.default=t.materials["MapDefault"],r.remesh(t.scene),e.map=r,e.controlTower.position.copy(n).addScalar(.5);for(let i=1;i<=e.checkpointCount;++i)e.iterateRandomMapPoint((r,n)=>{if("Pavement"===r.tiTy.key){const s=new a(t,i,n);return r.special=s,e.checkpoints.push(s),!0}});e.openTileCount=0,e.iterateMap((t,r)=>{e.isTileOpen(t)&&++e.openTileCount}),e.openTileCount<2&&(console.warn("Seed generated a map without enough open tiles, regenerating..."),e.regenerateMap())}placeBots(){const e=this;e.rngPlaceBots=e.rngMapGen.clone();const t=e.rngPlaceBots;for(const r of e.players)r.bot.clearTiEns(),r.bot.directionKey="N";for(const r of e.players)r.alive&&e.iterateRandomMapPoint((n,i)=>{if(e.isTileOpen(n)&&!n.entity){const{bot:e}=r;return e.rotate(t.choose(4),!1),e.object3d.position.copy(i),e.enterOnMap(),!0}},t)}iterateMap(e,t){const r=this,{map:n}=r,{dim:i,tiEns:o}=n.tiMa;for(let a=1;a<i.z-1;++a)for(let t=1;t<i.x-1;++t){const r=new s["Vector3"](t,n.groundHeight,a),c=i.resolve(r),h=o[c];if(e(h,r))break}}iterateRandomMapPoint(e,t){const r=this,{map:n}=r,{dim:i,tiEns:o}=n.tiMa;t||(t=r.rngMapGen);while(1){const r=new s["Vector3"](1+t.choose(i.x-2),n.groundHeight,1+t.choose(i.z-2)),a=i.resolve(r),c=o[a];if(e(c,r))break}}removePlayerByFunc(e){const t=this.players.findIndex(e);if(t>=0){const e=this.players[t];return e.destroy(),this.players.splice(t,1),e}}removePlayerByNetKey(e){this.removePlayerByFunc(t=>t.netKey===e)}getPlayerById(e){return this.players.find(t=>t.id===e)}getPlayerByNetKey(e){return this.players.find(t=>t.netKey===e)}getPlayerByPnid(e){return this.players.find(t=>t.pnid===e)}serialize(){const{turn:e,rng:t,rngMapGen:r,rngCosmetic:n,rngPlaceBots:i,players:s,handSize:o,checkpointCount:a,slotCount:c,endTurn:h,checkpoints:l}=this;return{turn:e,handSize:o,checkpointCount:a,slotCount:c,endTurn:h,rng:t.serialize(),rngMapGen:r.serialize(),rngCosmetic:n.serialize(),rngPlaceBots:i.serialize(),players:s.map(e=>e.serialize(!0)),checkpoints:l.map(e=>e.serialize())}}deserialize(e){const{turn:t,checkpointCount:r,handSize:n,slotCount:i,endTurn:s,rng:o,rngMapGen:c,rngCosmetic:h,rngPlaceBots:l,players:u,checkpoints:d}=e;if(void 0!==t&&(this.turn=t),void 0!==r&&(this.checkpointCount=r),void 0!==n&&(this.handSize=n),void 0!==i&&(this.slotCount=i),void 0!==s&&(this.endTurn=s),void 0!==o&&this.rng.deserialize(o),void 0!==c&&this.rngMapGen.deserialize(c),void 0!==h&&this.rngCosmetic.deserialize(h),void 0!==l&&this.rngPlaceBots.deserialize(l),void 0!==d){for(const e of this.checkpoints)e.destroy();this.checkpoints=d.map(e=>a.deserializeNew(this.game,e))}if(void 0!==u){this.destroyPlayers();const{game:e}=this;for(const t of u){let r=this.getPlayerById(t.id);r?r.deserialize(t):r=Object(p["c"])(e,t),t.id=r.id}for(const t of u){const{killedBy:e,id:r}=t;if(void 0===r)continue;const n=this.getPlayerById(r);n.killedBy=e?e.map(e=>this.getPlayerById(e)):[]}this.turnPlayers=[],this.deadPlayers=[];for(const t of this.players)t.alive?this.turnPlayers.push(t):this.deadPlayers.push(t)}}enterBots(){for(const e of this.players){const{bot:t}=e;t&&t.alive&&e.alive&&t.clearTiEns()}for(const e of this.players){const{bot:t}=e;t&&t.alive&&e.alive&&t.enterOnMap()}}}var v=r("787d");r.d(t,"a",(function(){return n["a"]})),r.d(t,"b",(function(){return i["a"]})),r.d(t,"e",(function(){return u})),r.d(t,"d",(function(){return g})),r.d(t,"c",(function(){return v["a"]}))},5:function(e,t){},"53d0":function(e,t,r){"use strict";const n=r("b04a"),i=r("6101"),s=r("22e8"),o=r("ecd7"),a=r("2b27"),c=r("e06e"),h=r("b1bf"),l=r("2f0b"),u=r("3591"),d=r("4fcb"),p=["/dns4/ams-1.bootstrap.libp2p.io/tcp/443/wss/ipfs/QmSoLer265NRgSp2LA3dPaeykiS1J6DifTC88f5uVQKNAd","/dns4/lon-1.bootstrap.libp2p.io/tcp/443/wss/ipfs/QmSoLMeWqB7YGVLJN3pNLQpmmEk35v6wYtsMGLzSr5QBU3","/dns4/sfo-3.bootstrap.libp2p.io/tcp/443/wss/ipfs/QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM","/dns4/sgp-1.bootstrap.libp2p.io/tcp/443/wss/ipfs/QmSoLSafTMBsPKadTEgaXctDQVcqN88CNLHXMkTNwMKPnu","/dns4/nyc-1.bootstrap.libp2p.io/tcp/443/wss/ipfs/QmSoLueR4xBeUbY9WZ9xGUUxunbKWcrNFTDAadQJmocnWm","/dns4/node0.preload.ipfs.io/tcp/443/wss/ipfs/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/ipfs/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6"];class m extends u{constructor(e){const t=new n({id:e.peerInfo.id}),r=new s({id:e.peerInfo.id}),u={switch:{denyTTL:12e4,denyAttempts:5,maxParallelDials:100,maxColdCalls:25,dialTimeout:2e4},modules:{transport:[t,i,r],streamMuxer:[o],connEncryption:[a],peerDiscovery:[t.discovery,r.discovery,c],dht:h,pubsub:l},config:{peerDiscovery:{autoDial:!0,webRTCStar:{enabled:!0},websocketStar:{enabled:!0},bootstrap:{interval:2e4,enabled:!0,list:p}},relay:{enabled:!0,hop:{enabled:!1,active:!1}},dht:{enabled:!1},pubsub:{enabled:!0,emitSelf:!0}}};super(d(u,e))}}const f=r("ccf6");function y(e){f.create((t,r)=>{if(t)return e(t);const n=r.id.toB58String(),i=`/dns4/star-signal.cloud.ipfs.team/tcp/443/wss/p2p-webrtc-star/p2p/${n}`,s="/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star";r.multiaddrs.add(i),r.multiaddrs.add(s);const o=new m({peerInfo:r});o.idStr=n,e(null,o)})}let g;function v(e){g&&g.stop(),y((t,r)=>{g=r,e(t,r)})}r.d(t,"a",(function(){return v}))},6:function(e,t){},6291:function(e,t){Math.nextPowerOfTwo=function(e){return 0===e?1:(--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1)},Math.clamp=function(e,t,r){return Math.min(Math.max(e,t),r)},Math.lerp=function(e,t,r){return e*(1-r)+t*r}},7:function(e,t){},7796:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("abf7"),i=r("ac93");class s{constructor(e){this.cardType=e}invoke(e){this.cardType.func(e)}removeFromHand(){const e=n["a"].hand.indexOf(this);e>=0&&n["a"].hand.splice(e,1)}serialize(){return{cardType:this.cardType.key}}deserialize(e){return this.cardType=i["b"][e.cardType],this}}},"787d":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return C}));r("ac6a");var n=r("5a89"),i=r("682a"),s=r("c64e"),o=r.n(s),a=r("2b0e"),c=(r("0313"),r("fd7d")),h=r("81d6"),l=r("346e"),u=r("ac93"),d=r("3b8b"),p=r("d328"),m=r("53d0"),f=r("abf7"),y=r("7796"),g=r("028a"),v=r("43b4"),b=r("1fb5");const x="boltbots-20191013",w=1e3,P=5e3,S=5*w,T=6e5,M=!0;let z;class C{constructor(){this.ready=!1,this.state="matchmaking",this.isJoining=!1,this.match=void 0,this.netNodeIdStr="",this.discoveredPeerCount=0,this.playersOnlineCount=0,this.connectedPeers=[],this.openMatches=[],this.pnid=o()(),this.netMatch=void 0,this.password=void 0,this.chatMessages=[],this.newChatMessages=!1,this.turnTimer=new n["Clock"](!1),this.turnTimerHost=new n["Clock"](!1),this.netKeyHost="",this.isHost=!1,this.reconnectData=void 0,Object(c["a"])(this),z&&window.removeEventListener("beforeunload",z),M&&(z=()=>this.storeReconnectData(),window.addEventListener("beforeunload",z)),this.netNode=void 0,this.netTopics={global:{topic:x,subscribed:!1},player:{topic:"",subscribed:!1},match:{topic:"",subscribed:!1},host:{topic:"",subscribed:!1}},this.playersOnline={},this.lastPingGlobal=Date.now(),this.lastPingHostCheck=Date.now(),this.matchHistory=[],this.matchHistoryLast=void 0,this.cryptoKeySvPrivate=void 0,this.cryptoKeySvPrivateEx=void 0,this.cryptoKeySvPublicEx=void 0,this.cryptoPnidMsg=void 0;const e=JSON.parse(localStorage.getItem("reconnectData"));if(e&&Date.now()-e.time<T){this.reconnectData=e;const{pnid:t,netMatch:r,cryptoKeySvPrivateEx:n,cryptoKeySvPublicEx:i}=e;this.pnid=t,this.netMatch=r,this.cryptoKeySvPrivateEx=n,this.cryptoKeySvPublicEx=i}this.sfxf=new d["a"](this),this.readyFunc=void 0,this.tiTys=void 0,this.models={},this.materials={},this.fonts={},this.scene=void 0,this.envMap=void 0,this.audioListener=void 0,this.threeTest=void 0,this.explosionMaterial=void 0,this.explosionGeometry=void 0,this.clock=new n["Clock"]}get netKey(){return this.netNodeIdStr}get matchUid(){return this.netMatch.matchUid}finishTankLoaderItem(e){const t=e.gltf;t.scene.traverseVisible(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),this.models[e.name]=t.scene}async cryptoPnidMsgInit(){const e={pnid:this.pnid,netKey:this.netKey},t=new TextEncoder("utf-8").encode(JSON.stringify(e));this.cryptoPnidMsg={type:"pnid-show",payload:e,signature:b["fromByteArray"](new Uint8Array(await crypto.subtle.sign(v["b"],this.cryptoKeySvPrivate,t)))}}async asyncInit(){if(void 0!==this.cryptoKeySvPrivateEx&&void 0!==this.cryptoKeySvPublicEx)this.cryptoKeySvPrivate=await crypto.subtle.importKey("jwk",this.cryptoKeySvPrivateEx,v["a"],!1,["sign"]);else{const e=await crypto.subtle.generateKey(v["a"],!0,["sign","verify"]);this.cryptoKeySvPrivate=e.privateKey,this.cryptoKeySvPrivateEx=await crypto.subtle.exportKey("jwk",this.cryptoKeySvPrivate),this.cryptoKeySvPublicEx=await crypto.subtle.exportKey("jwk",e.publicKey)}const e=new n["MeshStandardMaterial"]({color:16711680,emissive:new n["Color"](.5,.25,0),metalness:.99,roughness:.01,envMapIntensity:1});this.models["lazor-orb"]=new n["Mesh"](new n["SphereBufferGeometry"](.02,32,32),e),new i["Tween"](e.emissive).to(new n["Color"](.75,.5,.1),750).repeat(1/0).yoyo(!0).easing(i["Easing"].Bounce.InOut).start(),this.explosionMaterial=new n["ShaderMaterial"]({uniforms:{tExplosion:{type:"t",value:(new n["TextureLoader"]).load("statics/textures/explosion/explosion.png")},time:{type:"f",value:0}},vertexShader:p["c"].vertexShader,fragmentShader:p["c"].fragmentShader}),this.explosionGeometry=new n["IcosahedronGeometry"](20,4),this.materials["MapDefault"]=new n["MeshStandardMaterial"]({color:16777215,metalness:.9,roughness:.2,envMapIntensity:1,vertexColors:n["VertexColors"]}),this.materials["Hover"]=new n["MeshBasicMaterial"]({color:new n["Color"](.1,.1,1)});const t=Object(h["f"])(),r=new l["c"]("statics/models/vehicle/TestTank.glb","Bot"),s=[new l["b"]("statics/fonts/3d/droid/droid_sans_bold.typeface.json","Default")],o=[...t,r,...s],a=new l["a"](o,(e,n)=>{if(!e)return void console.error("loaderControl failed");for(const t of s)this.fonts[t.name]=t.font;const i={};for(const r of t)i[r.name]=new h["d"](r.gltf.scene);this.tiTys=Object(u["f"])(i),this.finishTankLoaderItem(r),Object(u["e"])(this),this.ready=!0,this.readyFunc&&this.readyFunc(this),this.initNetNode()});a.start()}preAnimateFunc(){this.explosionMaterial.uniforms["time"].value=this.clock.getElapsedTime()}createExplosionObj(e=1){const t=new n["Mesh"](this.explosionGeometry,this.explosionMaterial);return t.scale.setScalar(.025*e),t.bloom=!0,t}createExplosion(e,t=1,r=750){const n={size:.01},s=this.createExplosionObj(n.size);return new i["Tween"](n).to({size:t},r).onUpdate(()=>{s.scale.setScalar(.025*n.size)}).yoyo(!0).repeat(1).easing(i["Easing"].Quartic.InOut).onComplete(()=>s.removeSelf()).onRepeat(e||null).start(),this.scene.add(s),s}initNetNode(){Object(m["a"])((e,t)=>{if(e)return console.error("createNetNode failed, check if your browser has WebRTC Support",e);this.netNode=t,t.on("peer:discovery",e=>{++this.discoveredPeerCount}),t.on("peer:connect",e=>{e.idStr=e.id.toB58String(),this.connectedPeers.push(e)}),t.on("peer:disconnect",e=>{let t=this.connectedPeers.indexOf(e);t>=0&&this.connectedPeers.splice(t,1)}),t.once("peer:connect",async e=>{await this.cryptoPnidMsgInit(),this.subscribeGlobal(),this.subscribePlayerSelf(),new i["Tween"]({}).to({},1).repeatDelay(w).repeat(1/0).onRepeat(()=>this.netUpdate()).start(),this.reconnectData&&this.startReconnect()}),t.start(e=>{if(e)return console.error("netNode.start failed:",e);const r=t.peerInfo.id.toB58String();this.netNodeIdStr=r})})}checkMatchmakingTimeouts(e){const t=Date.now(),r=[];let n=0;for(const[i,s]of Object.entries(e)){if(s.lastPing){if(t-s.lastPing>S){r.push(i);continue}}else s.lastPing=t;++n}for(const i of r)a["a"].delete(e,i);return n}netUpdate(){const{match:e}=this,t=Date.now();if(t-this.lastPingGlobal>P&&(this.lastPingGlobal=t,this.isHost&&"lobby"===this.state?this.publishGlobal({type:"ping-global",matchUid:this.matchUid}):this.publishGlobal({type:"ping-global"})),"matchmaking"!==this.state&&"lobby"!==this.state||(this.playersOnlineCount=this.checkMatchmakingTimeouts(this.playersOnline)),"matchmaking"===this.state)this.checkMatchmakingTimeouts(this.openMatches);else if("lobby"===this.state||"playing"===this.state){const{netMatch:r,turnTimerHost:n,pnid:i}=this,{playerSelf:s,players:o,gameOver:a,turn:c}=e,{endTurn:h,completeTurn:l}=s,u=e.getPlayerByNetKey(this.netKeyHost);if(this.publishMatch({type:"ping-match",turn:c,endTurn:h,completeTurn:l,hostVote:void 0===u||u.lastPingTimeout||u.left?i:u.pnid}),a){for(const e of o)e.endTurn=!1,e.completeTurn=!1;return}for(const e of o)e.lastPingTimeout=e!==s&&t-e.lastPing>S;if(this.isHost)if(!e.turnInProgress&&r.endTurnTimeLimit>0&&n.running&&n.elapsedTime>=r.endTurnTimeLimit)console.log("turnTimerHost hostEndTurnPublish"),this.hostEndTurnPublish();else for(const e of o)if(e!==s&&e.lastPingTimeout){const t=s.completeTurn;this.publishMatch({type:"timeout-player",playerId:e.id,completeTurn:t})}}}storeReconnectData(){if("playing"!==this.state)return;const{matchUid:e,pnid:t,netKeyHost:r,match:n,netMatch:i,cryptoKeySvPublicEx:s,cryptoKeySvPrivateEx:o}=this;n.gameOver?this.clearReconnectData():e&&r&&n.playerSelf&&localStorage.setItem("reconnectData",JSON.stringify({time:Date.now(),matchUid:e,pnid:t,netKeyHost:r,netMatch:i,cryptoKeySvPublicEx:s,cryptoKeySvPrivateEx:o,matchData:n.serialize()}))}clearReconnectData(){this.reconnectData=void 0,localStorage.removeItem("reconnectData"),"reconnecting"===this.state&&(this.state="matchmaking",this.subscribeGlobal(),this.unsubscribeMatch(),this.unsubscribeHost())}startReconnect(){this.state="reconnecting";const{netKeyHost:e,matchUid:t,matchData:r}=this.reconnectData;this.lastPingSelf=Date.now(),this.netKeyHost=e,this.setMatchHistoryLast(r),this.unsubscribeGlobal(),this.subscribeMatch(t),this.unsubscribeHost(),this.state="playing"}setMatchHistoryLast(e){if(this.match.placeBots(),this.matchHistory=[e],this.matchHistoryLast=e,this.deserializeMatch(e),this.match.endTurn)for(const t of this.match.players)t.endTurn=!0;this.regenerateMap(!1)}sendChatMessage(e){this.match.playerSelf&&this.publishMatch({type:"chat",text:e})}subHandleHosting(e,t,r){t&&!e||a["a"].set(this.openMatches,r.matchUid,r)}obtainOpenMatch(e,t){const{matchUid:r}=t;let n=this.openMatches[r];const i=n&&n.netKeyHost===e.from;return{matchUid:r,openMatch:n,msgFromOpenMatchHost:i}}netHandleGlobal(e){const t=JSON.parse(e.data),{matchUid:r,openMatch:n,msgFromOpenMatchHost:i}=this.obtainOpenMatch(e,t),s=e.from===this.netKey;switch(t.type){case"ping-global":{const t=Date.now();this.lastPingSelf=t,this.playersOnline[e.from]={lastPing:t},s||(i?n.lastPing=t:this.publishHostOther(r,{type:"discover"}))}break;case"hosting":this.subHandleHosting(i,n,t);break;case"hosting-update":if(!i)return;t.playerCount>0?n.playerCount=t.playerCount:a["a"].delete(this.openMatches,r);break;case"transfer-host-global":if(!i)return;n.playerName=t.newHostName,n.netKeyHost=t.netKeyHost,--n.playerCount,n.playerCount<=0&&a["a"].delete(this.openMatches,r);break;case"close-match":if(!i)return;this.netMatch!==n&&a["a"].delete(this.openMatches,r);break;default:this.gotUnknownMessage("netHandleGlobal",e)}}netHandleMatch(e){const{match:t}=this,{players:r,turnPlayers:n,playerSelf:i}=t,s=e.from===this.netKey,o=e.from===this.netKeyHost,a=!this.isHost&&o,c=JSON.parse(e.data);let h=t.getPlayerByNetKey(e.from);"reconnecting"===this.state&&(h=void 0);const l=t=>this.publishPlayerOther(e.from,t);switch(c.type){case"ping-match":if("reconnecting"===this.state)return;if(!h)return void l({type:"pnid-request"});if(h.left)return;if(this.lastPingSelf=Date.now(),h.lastPing=Date.now(),h.lastPingTimeout=!1,"lobby"!==this.state){h.hostVote=c.hostVote;const e=new Map;let n=0,i=0;for(const s of r)s.lastPingTimeout||++n,void 0!==t.getPlayerByPnid(s.hostVote)&&(e.set(s.hostVote,(e.get(s.hostVote)||0)+1),++i);if(e.size>0&&i>=n){let r;if(1===e.size)r=e.entries().next().value[0];else{const t=Array.from(e.entries());t.sort((e,t)=>e[1]-t[1]),r=t[0][0]}const n=r===this.pnid,i=t.getPlayerByPnid(r).netKey;this.netKeyHost!==i?console.log("Game.netHandleMatch ping-match: New host with pnid "+r+(n?" (self)":" (other)")):n&&!this.isHost&&console.log("Game.netHandleMatch ping-match: Reinstating self as host with pnid "+r);const s=n&&this.netKeyHost!==i;this.changeNetKeyHost(i),s&&this.publishMatch({type:"match-rectify",match:this.match.serialize()})}else this.isHost&&(this.isHost=!1,console.log(`Game.netHandleMatch ping-match: Host uncertainty. hostVotes.size=${e.size} totalVoteCount=${i} requiredVoteCount=${n}`));t.gameOver||(c.turn!==t.turn||!1!==t.endTurn&&c.endTurn!==t.endTurn?this.isHost&&!s&&(t.endTurn?h.endTurn=!0:(h.endTurn=!1,h.completeTurn=!1),l({type:"match-rectify",match:this.match.serialize()}),console.log(`Game.netHandleMatch ping-match: Send match-rectify to ${h.pnid} aka ${h.name}`)):(h.endTurn=c.endTurn,h.completeTurn=c.completeTurn)),this.isHost&&Date.now()-this.lastPingHostCheck>w&&(this.lastPingHostCheck=Date.now(),this.hostCheckTurnProgress())}break;case"match-rectify":if(!o||s)return;this.setMatchHistoryLast(c.match);break;case"timeout-player":{if(!o)return;const e=t.getPlayerById(c.id);if(!e)return;e.endTurn=!0,e.completeTurn=c.completeTurn,this.hostCheckTurnProgress()}break;case"kick":if(!o)return;c.netKey===this.netKey?this.isHost||(--this.netMatch.playerCount,this.leaveSub()):(this.removePlayerByNetKey(c.netKey),this.hostingUpdate());break;case"chat":const d=h?h.name||"[NO PLAYER NAME]":"[UNKNOWN PLAYER]";this.chatMessages.unshift({playerName:d,text:c.text}),f["a"].rightDrawerOpen||(this.newChatMessages=!0);break;case"other-player-joined":if(!a)return;if(c.player.id===i.id)return;Object(u["c"])(this,c.player),t.placeBots();break;case"other-player-left":if(!o)return;if(c.netKey===this.netKey)return;this.removePlayerByNetKey(c.netKey),this.hostingUpdate();break;case"transfer-host-match":if(!a)return;this.removePlayerByNetKey(this.netKeyHost),this.netKeyHost=c.netKeyHost,this.netMatch.netKeyHost=c.netKeyHost,this.netKey===this.netKeyHost&&this.becomeHost();break;case"leave-match":if(!h)return;h.left=!0,h.endTurn=!0,h.completeTurn=!0;break;case"start-match":if(!o)return;t.handSize=this.netMatch.handSize,t.checkpointCount=this.netMatch.checkpointCount,t.slotCount=this.netMatch.slotCount,t.placeBots(),this.matchHistory=[t.serialize()],this.matchHistoryLast=this.matchHistory[0],this.deserializeMatch(this.matchHistory[0]),this.state="playing";break;case"end-turn-cosmetic":{if(!h)return;if(c.turn<t.turn)return;h.bot.object3d.add(this.sfxf.cpasEndTurn()),h.endTurn=!0;const e=n.reduce((e,t)=>e+(t.endTurn?1:0),0);1===e&&this.netMatch.endTurnTimeLimit>0&&(this.turnTimer.start(),this.isHost&&this.turnTimerHost.start())}break;case"start-turn":if(!o)return;this.turnTimer.stop(),this.isHost&&this.turnTimerHost.stop(),this.matchHistory.push(c.matchData),this.matchHistoryLast=c.matchData,this.deserializeMatch(c.matchData),this.startTurn();break;case"complete-turn-cosmetic":if(!h)return;if(!t.turnInProgress)return;if(c.turn<t.turn)return;h.completeTurn=!0;break;case"complete-turn-all":if(!o)return;for(const e of r){const t=e.left;e.endTurn=t,e.completeTurn=t}t.endTurn=!1,t.turnInProgress=!1,this.matchHistoryLast=this.match.serialize();break;default:this.gotUnknownMessage("netHandleMatch",e)}}netHandleHost(e){const{match:t,matchUid:r}=this,{players:n,turnInProgress:i}=t,s=JSON.parse(e.data);let o=t.getPlayerByNetKey(e.from);const a=t=>this.publishPlayerOther(e.from,t);switch(s.type){case"discover":if("lobby"!==this.state)return;a(this.netMatch);break;case"try-join":if("lobby"!==this.state)return void a({type:"join-result",matchUid:r,cantJoinReason:"match-closed"});if(this.password&&s.password!==this.password)a({type:"join-result",matchUid:r,cantJoinReason:"wrong-password"});else{let t=s.playerName;while(1){const e=n.find(e=>e.name===t);if(!e)break;const r=e.name.match(/(.*?)(\d*)$/);t=`${r[1]}${r[2]?parseInt(r[2])+1:" 2"}`}const{cryptoKeySvPublicEx:i}=s,o=Object(u["c"])(this,t,i);o.netKey=e.from,o.pnid=s.pnid,this.match.placeBots(),a({type:"join-result",matchUid:r,players:n.map(e=>e.serialize(!1)),playerSelfId:o.id}),this.publishMatch({type:"other-player-joined",player:o.serialize(!1),cryptoKeySvPublicEx:i}),this.hostingUpdate()}break;case"leave":if("lobby"!==this.state||!o)return;this.publishMatch({type:"other-player-left",netKey:o.netKey});break;case"end-turn-host":if("playing"!==this.state||!o||i||s.turn<t.turn)return;o.endTurn=!0,o.hand=s.hand.map(e=>(new y["a"]).deserialize(e)),o.bot.cardSlots=s.cardSlots.map(e=>(new g["a"]).deserialize(e)),this.hostEndTurn();break;case"complete-turn-host":if("playing"!==this.state||!o||!i||s.turn<t.turn)return;o.completeTurn=!0,this.hostCompleteTurn();break;default:this.gotUnknownMessage("netHandleHost",e)}}netHandlePlayerSelf(e){const{match:t}=this,r=JSON.parse(e.data),{openMatch:n,msgFromOpenMatchHost:i}=this.obtainOpenMatch(e,r),s=e.from===this.netKeyHost,o=e.from===this.netKey,a=t=>this.publishPlayerOther(e.from,t);switch(r.type){case"pnid-request":a(this.cryptoPnidMsg);break;case"pnid-show":if("playing"!==this.state)return;const c=r.payload,h=new TextEncoder("utf-8").encode(JSON.stringify(c)),l=t.getPlayerByPnid(c.pnid);if(void 0===l.cryptoKeySvPublic)return;if(void 0===l)return void console.warn(`Game.netHandlePlayerSelf pnid-show: Received invalid cryptoPnid.pnid='${c.pnid}', with cryptoPnid.netKey='${c.netKey}', msg.from='${e.from}'`);const u=b["toByteArray"](r.signature);crypto.subtle.verify(v["b"],l.cryptoKeySvPublic,u,h).then(t=>{t?c.netKey===e.from?(l.netKey=c.netKey,o||console.log("Game.netHandlePlayerSelf pnid-show from other pnid: "+l.pnid)):console.warn(`Game.netHandlePlayerSelf pnid-show: Received potential forgery, with msg.from='${e.from}' but cryptoPnid.netKey='${c.netKey}' for cryptoPnid.pnid='${c.pnid}'`):console.warn(`Game.netHandlePlayerSelf pnid-show: Received potential forgery, with invalid signature for cryptoPnid.netKey='${c.netKey}' and cryptoPnid.pnid='${c.pnid}'; msg.from='${e.from}'`)});break;case"match-rectify":if(!s)return;console.log("Game.netHandlePlayerSelf match-rectify"),this.setMatchHistoryLast(r.match);break;case"hosting":this.subHandleHosting(i,n,r);break;case"join-result":if(!i||r.matchUid!==this.isJoining)return;this.isJoining=!1,r.cantJoinReason?this.joinFailed("rejected",r.cantJoinReason):this.joined(e.from,this.openMatches[r.matchUid],r.players,r.playerSelfId);break;default:this.gotUnknownMessage("netHandlePlayerSelf",e)}}gotUnknownMessage(e,t){console.warn(e,"- Got unknown message from",t.from,"- Content:",t.data)}assembleTopic(e,t){return`${x}/${e}/${t}`}setTopicDirect(e,t="",r){const n=this.netTopics[e],i=n.topic!==t||r;n.subscribed&&i&&(this.netNode.pubsub.unsubscribe(n.topic),n.subscribed=!1),n.topic=t,r&&(this.netNode.pubsub.subscribe(n.topic,r),n.subscribed=!0)}setTopic(e,t="",r){this.setTopicDirect(e,this.assembleTopic(e,t),r)}unsubscribeTopic(e){const t=this.netTopics[e];t.subscribed&&(this.netNode.pubsub.unsubscribe(t.topic),t.subscribed=!1)}publishTopicDirect(t,r){t&&this.netNode.pubsub.publish(t,e.from(JSON.stringify(r)))}publishTopic(e,t){const{topic:r}=this.netTopics[e];this.publishTopicDirect(r,t)}subscribeGlobal(){this.setTopicDirect("global",x,e=>this.netHandleGlobal(e))}unsubscribeGlobal(){this.unsubscribeTopic("global")}subscribePlayerSelf(){this.setTopic("player",this.netKey,e=>this.netHandlePlayerSelf(e))}subscribeMatch(e){this.setTopic("match",e||this.matchUid,e=>this.netHandleMatch(e))}unsubscribeMatch(){this.unsubscribeTopic("match")}subscribeHost(){this.setTopic("host",this.matchUid,e=>this.netHandleHost(e))}unsubscribeHost(){this.unsubscribeTopic("host")}publishGlobal(e){this.publishTopic("global",e)}publishMatch(e){this.publishTopic("match",e)}publishHost(e){this.publishTopic("host",e)}publishHostNew(e,t){this.setTopic("host",e),this.publishHost(t)}publishHostOther(e,t){this.publishTopicDirect(this.assembleTopic("host",e),t)}publishPlayerOther(e,t){this.publishTopicDirect(this.assembleTopic("player",e),t)}deserializeMatch(e){f["a"].threejsControls.autoRotate=!1;const{match:t}=this;t.deserialize(e),t.enterBots(),t.playerSelf=t.getPlayerByPnid(this.pnid),f["a"].adjustPlayerSelf(),this.storeReconnectData()}removePlayerByNetKey(e){const{match:t,state:r,netMatch:n}=this;t.removePlayerByNetKey(e),"lobby"===r&&t.placeBots(),n&&(n.playerCount=t.players.length)}host(e){const t=this.netKey+"-"+o()(),{match:r}=this;r.destroyPlayers(),r.playerSelf=Object(u["c"])(this,e.playerName,this.cryptoKeySvPublicEx),f["a"].adjustPlayerSelf(),r.playerSelf.netKey=this.netKey,r.playerSelf.pnid=this.pnid,r.placeBots(),this.password=e.password,e.password=!!e.password,e.playerCount=1,e.matchUid=t,e.netKeyHost=this.netKey,e.type="hosting",a["a"].set(this.openMatches,t,e),this.netMatch=e,this.becomeHost(),this.publishGlobal(e),this.state="lobby"}hostingUpdate(e){if(!this.isHost)return;void 0===e&&(e=this.match.players.length);const{matchUid:t}=this;this.publishGlobal({type:"hosting-update",matchUid:t,playerCount:e})}becomeHost(){this.unsubscribeGlobal(),this.subscribeMatch(),this.subscribeHost(),this.changeNetKeyHost(this.netKey)}changeNetKeyHost(e){this.netKeyHost=e,this.isHost=this.netKey===e,this.isHost?this.subscribeHost():this.unsubscribeHost()}returnToLobby(){this.clearReconnectData(),this.match.gameOver=!1,this.regenerateMap(!0),this.matchHistoryLast=void 0,this.matchHistory=[],this.unsubscribeHost(),this.leaveSub()}tryJoin(e,t,r){this.password=r;const n=this.openMatches[e];if(n.playerCount>=n.maxPlayers)return;if(n.password){if(!r)return void this.joinFailed("empty-password")}else r=void 0;this.isJoining=e,this.isHost=!1;const{pnid:i,cryptoKeySvPublicEx:s}=this;this.publishHostNew(e,{type:"try-join",playerName:t,password:r,pnid:i,cryptoKeySvPublicEx:s})}joinFailed(e,t){f["a"].dialogData={type:"join-failure",why:e,data:t},this.isJoining=!1}joined(e,t,r,n){if(!t)return;const{match:i}=this;this.netKeyHost=e,this.state="lobby",this.netMatch=t,i.destroyPlayers();for(const s of r)Object(u["c"])(this,s);i.playerSelf=i.getPlayerById(n),f["a"].adjustPlayerSelf(),this.regenerateMap(),this.unsubscribeGlobal(),this.subscribeMatch()}leave(){if("playing"===this.state)this.publishMatch({type:"leave-match"});else{const{netMatch:e}=this;if(!e)return;if(this.isHost){this.subscribeGlobal(),this.unsubscribeHost();const t=this.match.players.find(e=>e.netKey!==this.netKey);if(t){const{matchUid:r}=e;this.publishGlobal({type:"transfer-host-global",matchUid:r,netKeyHost:t.netKey,newHostName:t.name}),this.publishMatch({type:"transfer-host-match",netKeyHost:t.netKey})}else this.hostingUpdate(0)}else this.publishHost({type:"leave"})}this.leaveSub()}leaveSub(){this.netMatch=void 0,this.unsubscribeHost(),this.unsubscribeMatch(),this.subscribeGlobal(),this.isHost=!1,this.state="matchmaking",this.regenerateMap()}kick(e){if(!this.isHost)return;if(e===this.match.playerSelf)return void this.leave();const{netMatch:t}=this;t&&(this.publishMatch({type:"kick",netKey:e.netKey}),this.hostingUpdate())}startMatch(){if("lobby"!==this.state)return;const{netMatch:e}=this;e&&(this.publishGlobal({type:"close-match",matchUid:e.matchUid}),this.publishMatch({type:"start-match"}))}endTurn(){if("playing"!==this.state)return;const{match:e}=this,{playerSelf:t,turn:r}=e;if(t.endTurn)return;t.endTurn=!0;const n=t.hand.map(e=>e.serialize()),i=t.bot.cardSlots.map(e=>e.serialize());this.publishHost({type:"end-turn-host",turn:r,hand:n,cardSlots:i}),this.publishMatch({type:"end-turn-cosmetic",turn:r})}startTurn(){for(const e of this.match.players)e.endTurn=!0,e.completeTurn=!1;this.match.startTurn()}completeTurn(){if("playing"!==this.state)return;const{match:e}=this,{playerSelf:t,turn:r}=e;t.completeTurn||(t.completeTurn=!0,this.publishHost({type:"complete-turn-host",turn:r}),this.publishMatch({type:"complete-turn-cosmetic",turn:r}))}hostEndTurn(){const{match:e}=this;if("playing"!==this.state||!this.isHost||e.turnInProgress)return!1;const t=this.match.turnPlayers.reduce((e,t)=>e&&(t.endTurn||t.lastPingTimeout),!0);return!!t&&(e.endTurn=!0,this.hostEndTurnPublish(),!0)}hostEndTurnPublish(){this.publishMatch({type:"start-turn",matchData:this.match.serialize()})}hostCheckTurnProgress(){this.isHost&&(this.hostCompleteTurn()||this.hostEndTurn())}hostCompleteTurn(){const{match:e}=this;if("playing"!==this.state||!this.isHost||!e.turnInProgress)return!1;const t=e.turnPlayers.reduce((e,t)=>e&&(t.completeTurn||t.lastPingTimeout),!0);return!!t&&(this.publishMatch({type:"complete-turn-all"}),!0)}regenerateMap(e=!0){const t=this,{match:r,netMatch:n}=t;"matchmaking"===t.state?(r.setRngSeedStr(f["a"].hostSeed),r.checkpointCount=f["a"].hostCheckpointCount,r.turn=1):(r.checkpointCount=n.checkpointCount,r.handSize=n.handSize,r.slotCount=n.slotCount,r.setRngSeedStr(n.seed)),r.regenerateMap(),e&&("matchmaking"===t.state?t.recreatePlayers():r.placeBots())}recreatePlayers(){const e=this;if("matchmaking"!==e.state)return;const{match:t}=e;t.destroyPlayers(),Object(u["d"])(e,f["a"].hostMaxPlayers),t.playerSelf=t.players[0],t.placeBots()}}}).call(this,r("1c35").Buffer)},8:function(e,t){},"81d6":function(e,t,r){"use strict";var n=r("5a89");const i=Object.freeze(["X-","X+","Y-","Y+","Z-","Z+"]);class s{constructor(e){for(const t of i)this[t]="function"===typeof e?e(t):e}iterate(e){for(const t of i)e(t,this[t])}}const o=Object.freeze(new s(e=>e[0]+("+"===e[1]?"-":"+")));class a extends n["Vector3"]{constructor(e,t,r){e=e||t||r,super(e,t||e,r||e),this.sq=this.x*this.y,this.cu=this.sq*this.z}iterate(e){const t=new n["Vector3"](0,0,0),{x:r,y:i,z:o}=this;let a=0;const c=new s(()=>({i:0,valid:!1}));for(c["X-"].i=-1,c["X+"].i=1,c["Y-"].i=-this.x,c["Y+"].i=+this.x,c["Z-"].i=-this.sq,c["Z+"].i=+this.sq,t.z=0;t.z<o;++t.z)for(c["Z-"].valid=t.z>0,c["Z+"].valid=t.z+1<o,t.y=0;t.y<i;++t.y)for(c["Y-"].valid=t.y>0,c["Y+"].valid=t.y+1<i,t.x=0;t.x<r;++t.x,++a){if(c["X-"].valid=t.x>0,c["X+"].valid=t.x+1<r,!1===e(t,a,c))return;c.iterate((e,t)=>++t.i)}}resolve(e){return e.x+e.y*this.x+e.z*this.sq}check(e){return e.x>=0&&e.y>=0&&e.z>=0&&e.x<this.x&&e.y<this.y&&e.z<this.z}}r("ac6a");var c=r("bf0e");class h{constructor(){this.index=new c["BufferAttributeExtIndex"],this.position=new c["BufferAttributeExt"](new Float32Array,3),this.normal=new c["BufferAttributeExt"](new Float32Array,3),this.color=new c["BufferAttributeExt"](new Float32Array,4)}forEachNonIndex(e){return e(this.position,"position"),e(this.normal,"normal"),e(this.color,"color"),this}forEach(e){return e(this.index,"index"),this.forEachNonIndex(e)}addAttributes(e){return e.setIndex(this.index),this.forEachNonIndex((t,r)=>e.addAttribute(r,t))}setDynamic(e){return this.forEach(t=>t.setDynamic(e))}fitSize(e=!0){return this.forEach(t=>t.fitSize(e))}clear(e=!1){return this.forEach(t=>t.clear(e))}createGeometry(){const e=new n["BufferGeometry"];return this.addAttributes(e),e}}const l=new n["MeshBasicMaterial"]({vertexColors:n["VertexColors"]});class u{constructor(e){this.dim=e,this.tiEns=[];for(let t=0;t<e.cu;++t)this.tiEns.push(void 0);this.bufferSets={},this.materials={default:l}}getBufferSet(e,t=!0){const r=this.bufferSets;return t?r[e]=r[e]||new h:r[e]}remesh(){const{dim:e,tiEns:t,bufferSets:r}=this;for(const n of Object.values(r))n.clear();e.iterate((e,r,n)=>{const i=t[r];if(!i)return;const s=i.tiTy,a=s.tiSh;a.sides.iterate((r,a)=>{const c=n[r];let h;if(c.valid&&t[c.i]){const e=t[c.i].tiTy.tiSh.sides[o[r]];h=!e.partialFull&&(e.partialStart>e.partialEnd||a.partialStart<a.partialEnd&&a.partialStart>=e.partialStart&&a.partialEnd<=e.partialEnd)}else h=!1;for(const t of a.shapes){if(h&&!t.always)continue;const r=t.obtainGeometry(i.rotation),n=this.getBufferSet(t.materialKey);d(r,n,e,s.color)}})});const i={};for(const[s,o]of Object.entries(r)){const e=this.materials[s];i[s]=new n["Mesh"](o.fitSize().createGeometry(),e)}return i}}function d(e,t,r,i){if(p(e,t,"position",e=>e.add(r)),p(e,t,"normal"),i||void 0!==e.getAttribute("color")||(i=new n["Vector4"](1,1,1,1)),i){const r=e.getAttribute("position").count;t.color.padSize(t.color.countCurrent+r);for(let e=0;e<r;++e)t.color.upushVector4(i)}else p(e,t,"color");t.index.pushRelative(...e.index.array)}function p(e,t,r,i){const s=e.getAttribute(r),o=t[r];if(o.padSize(o.countCurrent+s.count),i)if(3===s.itemSize)for(let a=0;a<s.array.length;a+=3)o.upushVector3(i(new n["Vector3"](s.array[a+0],s.array[a+1],s.array[a+2])));else console.error("copyAppendMod not implemented for frBuf.itemSize === "+s.itemSize);else for(let n=0;n<s.array.length;++n)o.array[o.indexCurrent++]=s.array[n]}class m{constructor(e){this.tiSh=e,this.color=void 0}}r("d014");class f{constructor(e){this.sides=new s(()=>({shapes:[],partialFull:!0,partialStart:1,partialEnd:0})),e.traverseControlled(e=>{if(!1===e.visible)return!1;if(this.sides[e.name]){const t=this.sides[e.name];return e.traverseControlled(e=>{const r=e.userData;return r.partial||(t.partialFull=!1),r.partialStart<t.partialStart&&(t.partialStart=r.partialStart),r.partialEnd>t.partialEnd&&(t.partialEnd=r.partialEnd),t.shapes.push(new y(e)),!0}),!1}return!0})}}class y{constructor(e){const t=e.userData;this.geometries={"X+":e.geometry,"X-":void 0,"Z+":void 0,"Z-":void 0},this.materialKey="default",this.always=!!t.always}get geometry(){return this.geometries["X+"]}obtainGeometry(e){const{geometries:t}=this;if(e=e||"X+",!t[e])switch(e){case"X-":t[e]=this.geometry.clone().rotateY(Math.PI);break;case"Z+":t[e]=this.geometry.clone().rotateY(1.5*Math.PI);break;case"Z-":t[e]=this.geometry.clone().rotateY(.5*Math.PI);break;default:console.error("Shape.obtainGeometry: Not implemented for "+e)}return t[e]}}class g{constructor(e){this.tiTy=e,this.rotation=void 0,this.entity=void 0,this.visited=!1,this.special=void 0}}var v=r("346e");const b=["Cube","CubeQuarter","Wall0","Wall1","Floor0","ConveyorSingle0","ConveyorDouble0","ControlTower0"];function x(){return b.map(e=>new v["c"]("statics/models/tiles/"+e+".glb",e))}r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return u})),r.d(t,"e",(function(){return m})),r.d(t,"d",(function(){return f})),r.d(t,"b",(function(){return g})),r.d(t,"f",(function(){return x}))},9:function(e,t){},"9d97":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c}));var n=r("5a89"),i=r("682a"),s=r("b217"),o=r("c380");const a=[];function c(e,t,r,s){r||(r=e.directionKey);const a=o["b"][r],c=o["c"][r],h=1e3+100*Math.abs(t),u=t>0?1:-1,d=e.object3d,p=d.position.clone();let m=[];const f=()=>{const t=e.engineSound;e.engineSoundGen.frequency.setValueAtTime(6,t.context.currentTime),t.setVolume(.01),e.cleanupVisitedTiles(),e.hoverEffect(!1),e.enterOnMap(!0),s?s():e.cardDone()},y=new n["Vector3"],g=new n["Vector3"],v=(t=!1)=>{if(m.length>0){for(const r of m)r.cleanupVisitedTiles(),t&&r.damage("crush",e.player);m=m.filter(e=>e.alive),m.unshift(e);for(let r=0;r<m.length;++r){const n=m.length-1-r,s=t?r:n,o=t?n:r,h=r===m.length-1,l=m[s];l.directionAxis!==c&&l.hoverEffect(!0);const d=g.clone().addScaledVector(a,u>0?-o-!!t:o+!!t);new i["Tween"](l.object3d.position).to(d,1100).delay(250*r).easing(i["Easing"].Quartic.InOut).onComplete(()=>{l!==e&&(l.hoverEffect(!1),l.enterOnMap(!0)),h&&f()}).start()}}else f()},b=v,x=d.position.clone().addScaledVector(a,t),w=d.position.clone();let P=new i["Tween"](d.position).to(x,h),S=!1,T=!0;const M=()=>{const r=.325,n=e.game.match.map,s=e.object3d.position.clone().sub(p),c=e.engineSound;e.engineSoundGen.frequency.setValueAtTime(6+100*s.length(),c.context.currentTime),c.setVolume(1);const h=m[m.length-1]||e;let l=h.object3d.position.clone().addScalar(.5).addScaledVector(a,u*r);if(m.length>0&&!S){const r=e.object3d.position.clone(),s=w.distanceTo(r),o=(t>0?t:-t)-s,a=o>m.length;y.copy(l).floor(),g.copy(y);const c=n.checkObstacle(y,h);if(a?"wall"===c:c)return T=!1,S=!0,P.stop(),void(P=new i["Tween"](e.object3d.position).to(y,250*e.object3d.position.distanceTo(y)).onUpdate(M).onComplete(()=>console.warn("mustCrush move finished irregularly")).start())}const d=n.checkObstacle(l,h);let f=!0;if(d)if(d instanceof o["a"]){const e=l.distanceTo(d.object3d.position.clone().addScalar(.5));e>.5*r&&(f=!1)}else T=!1;if(d&&f&&(T?h===d||d.damage("shove",e.player)||m.push(d):(g.copy(l).floor(),P.stop(),new i["Tween"](e.object3d.position).to(g.clone().addScaledVector(a,-u),500).easing(i["Easing"].Back.Out).onComplete(()=>b(!0)).start())),e.enterOnMap(),e.cleanupVisitedTiles(),m.length>0)for(const e of m)e.object3d.position.add(s),e.enterOnMap(),e.cleanupVisitedTiles();p.copy(e.object3d.position)};P.easing(l).onUpdate(M).onComplete(()=>b(!1)).start()}function h(e){return t=>c(t,e)}for(let u=1;u<=3;++u)a.push(new s["a"]("forward-"+u,"Forward x"+u,h(u)));for(let u=1;u<=2;++u)a.push(new s["a"]("backward-"+u,"Backward x"+u,h(-u)));function l(e){const t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:-.5*((e-=2)*e*e*e-2)}for(const{what:u,value:d}of[{what:"right",value:1},{what:"left",value:-1}])a.push(new s["a"]("rotate-"+u,"Rotate "+u,e=>{e.rotate(d)}));a.push(new s["a"]("u-turn","U-Turn",e=>{e.rotate(Math.random()>.5?2:-2)}))},abf7:function(e,t,r){"use strict";r("ac6a");var n=r("5a89"),i=r("682a"),s=r("34ad");function o(){var e=o.SkyShader,t=new n["ShaderMaterial"]({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:n["UniformsUtils"].clone(e.uniforms),side:n["BackSide"]});n["Mesh"].call(this,new n["BoxBufferGeometry"](1,1,1),t)}function a(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new n["Vector3"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:n["MOUSE"].LEFT,MIDDLE:n["MOUSE"].MIDDLE,RIGHT:n["MOUSE"].RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(i),r.update(),c=a.NONE},this.update=function(){var t=new n["Vector3"],s=(new n["Quaternion"]).setFromUnitVectors(e.up,new n["Vector3"](0,1,0)),o=s.clone().inverse(),f=new n["Vector3"],y=new n["Quaternion"];return function(){var e=r.object.position;return t.copy(e).sub(r.target),t.applyQuaternion(s),l.setFromVector3(t),r.autoRotate&&c===a.NONE&&z(T()),l.theta+=u.theta,l.phi+=u.phi,l.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,l.theta)),l.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=d,l.radius=Math.max(r.minDistance,Math.min(r.maxDistance,l.radius)),r.target.add(p),t.setFromSpherical(l),t.applyQuaternion(o),e.copy(r.target).add(t),r.object.lookAt(r.target),!0===r.enableDamping?(u.theta*=1-r.dampingFactor,u.phi*=1-r.dampingFactor,p.multiplyScalar(1-r.dampingFactor)):(u.set(0,0,0),p.set(0,0,0)),d=1,!!(m||f.distanceToSquared(r.object.position)>h||8*(1-y.dot(r.object.quaternion))>h)&&(r.dispatchEvent(i),f.copy(r.object.position),y.copy(r.object.quaternion),m=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",te,!1),r.domElement.removeEventListener("mousedown",W,!1),r.domElement.removeEventListener("wheel",q,{passive:!1}),r.domElement.removeEventListener("touchstart",$,!1),r.domElement.removeEventListener("touchend",ee,!1),r.domElement.removeEventListener("touchmove",J,!1),document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),window.removeEventListener("keydown",Q,!1)};var r=this,i={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},c=a.NONE,h=1e-6,l=new n["Spherical"],u=new n["Spherical"],d=1,p=new n["Vector3"],m=!1,f=new n["Vector2"],y=new n["Vector2"],g=new n["Vector2"],v=new n["Vector2"],b=new n["Vector2"],x=new n["Vector2"],w=new n["Vector2"],P=new n["Vector2"],S=new n["Vector2"];function T(){return 2*Math.PI/60/60*r.autoRotateSpeed}function M(){return Math.pow(.95,r.zoomSpeed)}function z(e){u.theta-=e}function C(e){u.phi-=e}var E=function(){var e=new n["Vector3"];return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),p.add(e)}}(),k=function(){var e=new n["Vector3"];return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),p.add(e)}}(),D=function(){var e=new n["Vector3"];return function(t,n){var i=r.domElement===document?r.domElement.body:r.domElement;if(r.object.isPerspectiveCamera){var s=r.object.position;e.copy(s).sub(r.target);var o=e.length();o*=Math.tan(r.object.fov/2*Math.PI/180),E(2*t*o/i.clientHeight,r.object.matrix),k(2*n*o/i.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(E(t*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),k(n*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function O(e){r.object.isPerspectiveCamera?d/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function j(e){r.object.isPerspectiveCamera?d*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function H(e){f.set(e.clientX,e.clientY)}function A(e){w.set(e.clientX,e.clientY)}function V(e){v.set(e.clientX,e.clientY)}function K(e){y.set(e.clientX,e.clientY),g.subVectors(y,f).multiplyScalar(r.rotateSpeed);var t=r.domElement===document?r.domElement.body:r.domElement;z(2*Math.PI*g.x/t.clientHeight),C(2*Math.PI*g.y/t.clientHeight),f.copy(y),r.update()}function B(e){P.set(e.clientX,e.clientY),S.subVectors(P,w),S.y>0?O(M()):S.y<0&&j(M()),w.copy(P),r.update()}function R(e){b.set(e.clientX,e.clientY),x.subVectors(b,v).multiplyScalar(r.panSpeed),D(x.x,x.y),v.copy(b),r.update()}function I(e){}function L(e){e.deltaY<0?j(M()):e.deltaY>0&&O(M()),r.update()}function U(e){switch(e.keyCode){case r.keys.UP:D(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:D(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:D(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:D(-r.keyPanSpeed,0),r.update();break}}function N(e){f.set(e.touches[0].pageX,e.touches[0].pageY)}function F(e){if(r.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);w.set(0,i)}if(r.enablePan){var s=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(s,o)}}function _(e){y.set(e.touches[0].pageX,e.touches[0].pageY),g.subVectors(y,f).multiplyScalar(r.rotateSpeed);var t=r.domElement===document?r.domElement.body:r.domElement;z(2*Math.PI*g.x/t.clientHeight),C(2*Math.PI*g.y/t.clientHeight),f.copy(y),r.update()}function G(e){if(r.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);P.set(0,i),S.set(0,Math.pow(P.y/w.y,r.zoomSpeed)),O(S.y),w.copy(P)}if(r.enablePan){var s=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(s,o),x.subVectors(b,v).multiplyScalar(r.panSpeed),D(x.x,x.y),v.copy(b)}r.update()}function Z(e){}function W(e){if(!1!==r.enabled){switch(0!==e.button&&e.preventDefault(),e.button){case r.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;V(e),c=a.PAN}else{if(!1===r.enableRotate)return;H(e),c=a.ROTATE}break;case r.mouseButtons.MIDDLE:if(!1===r.enableZoom)return;A(e),c=a.DOLLY;break;case r.mouseButtons.RIGHT:if(!1===r.enablePan)return;V(e),c=a.PAN;break}c!==a.NONE&&(document.addEventListener("mousemove",X,!1),document.addEventListener("mouseup",Y,!1),r.dispatchEvent(s))}}function X(e){if(!1!==r.enabled)switch(e.preventDefault(),c){case a.ROTATE:if(!1===r.enableRotate)return;K(e);break;case a.DOLLY:if(!1===r.enableZoom)return;B(e);break;case a.PAN:if(!1===r.enablePan)return;R(e);break}}function Y(e){!1!==r.enabled&&(I(e),document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),r.dispatchEvent(o),c=a.NONE)}function q(e){!1===r.enabled||!1===r.enableZoom||c!==a.NONE&&c!==a.ROTATE||(e.preventDefault(),e.stopPropagation(),r.dispatchEvent(s),L(e),r.dispatchEvent(o))}function Q(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&U(e)}function $(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===r.enableRotate)return;N(e),c=a.TOUCH_ROTATE;break;case 2:if(!1===r.enableZoom&&!1===r.enablePan)return;F(e),c=a.TOUCH_DOLLY_PAN;break;default:c=a.NONE}c!==a.NONE&&r.dispatchEvent(s)}}function J(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===r.enableRotate)return;if(c!==a.TOUCH_ROTATE)return;_(e);break;case 2:if(!1===r.enableZoom&&!1===r.enablePan)return;if(c!==a.TOUCH_DOLLY_PAN)return;G(e);break;default:c=a.NONE}}function ee(e){!1!==r.enabled&&(Z(e),r.dispatchEvent(o),c=a.NONE)}function te(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",te,!1),r.domElement.addEventListener("mousedown",W,!1),r.domElement.addEventListener("wheel",q,{passive:!1}),r.domElement.addEventListener("touchstart",$,!1),r.domElement.addEventListener("touchend",ee,!1),r.domElement.addEventListener("touchmove",J,!1),window.addEventListener("keydown",Q,!1),this.update()}o.prototype=Object.create(n["Mesh"].prototype),o.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new n["Vector3"]}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","  zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","  return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","  float c = ( 0.2 * T ) * 10E-18;","  return 0.434 * c * MieConst;","}","void main() {","  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","  vWorldPosition = worldPosition.xyz;","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","  gl_Position.z = gl_Position.w;","  vSunDirection = normalize( sunPosition );","  vSunE = sunIntensity( dot( vSunDirection, up ) );","  vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","  float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","  vBetaR = totalRayleigh * rayleighCoefficient;","  vBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","  return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","  float g2 = pow( g, 2.0 );","  float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","  return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","  return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","  float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","  float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","  float sR = rayleighZenithLength * inverse;","  float sM = mieZenithLength * inverse;","  vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","  float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","  float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","  vec3 betaRTheta = vBetaR * rPhase;","  float mPhase = hgPhase( cosTheta, mieDirectionalG );","  vec3 betaMTheta = vBetaM * mPhase;","  vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","  Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","  vec3 direction = normalize( vWorldPosition - cameraPos );","  float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","  float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","  vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","  vec3 L0 = vec3( 0.1 ) * Fex;","  float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","  L0 += ( vSunE * 19000.0 * Fex ) * sundisk;","  vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","  vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","  vec3 color = curr * whiteScale;","  vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","  gl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},a.prototype=Object.create(n["EventDispatcher"].prototype),a.prototype.constructor=a,Object.defineProperties(a.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var c=r("3191"),h=r.n(c);class l{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(e,t){}render(e,t,r,n,i){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}class u{constructor(e){this.camera=new n["OrthographicCamera"](-1,1,1,-1,0,1);const t=new n["PlaneBufferGeometry"](2,2);this._mesh=new n["Mesh"](t,e)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}render(e){e.render(this._mesh,this.camera)}}class d extends l{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r,n,i){var s,o,a=e.context,c=e.state;c.buffers.color.setMask(!1),c.buffers.depth.setMask(!1),c.buffers.color.setLocked(!0),c.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),c.buffers.stencil.setTest(!0),c.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),c.buffers.stencil.setFunc(a.ALWAYS,s,4294967295),c.buffers.stencil.setClear(o),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),c.buffers.color.setLocked(!1),c.buffers.depth.setLocked(!1),c.buffers.stencil.setFunc(a.EQUAL,1,4294967295),c.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP)}}class p extends l{constructor(){super(),this.needsSwap=!1}render(e,t,r,n,i){e.state.buffers.stencil.setTest(!1)}}class m extends l{constructor(e,t,r,n,i){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1}render(e,t,r,n,i){var s,o,a=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(s=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(s,o),this.scene.overrideMaterial=null,e.autoClear=a}}class f extends l{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof n["ShaderMaterial"]?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=n["UniformsUtils"].clone(e.uniforms),this.material=new n["ShaderMaterial"]({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new n["OrthographicCamera"](-1,1,1,-1,0,1),this.scene=new n["Scene"],this.quad=new n["Mesh"](new n["PlaneBufferGeometry"](2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}render(e,t,r,n,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera))}}var y=r("d328");class g extends l{constructor(e,t,r,i){super(),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=i,this.resolution=void 0!==e?new n["Vector2"](e.x,e.y):new n["Vector2"](256,256),this.clearColor=new n["Color"](0,0,0);var s={minFilter:n["LinearFilter"],magFilter:n["LinearFilter"],format:n["RGBAFormat"]};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new n["WebGLRenderTarget"](o,a,s),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var c=0;c<this.nMips;c++){var h=new n["WebGLRenderTarget"](o,a,s);h.texture.name="UnrealBloomPass.h"+c,h.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(h);var l=new n["WebGLRenderTarget"](o,a,s);l.texture.name="UnrealBloomPass.v"+c,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),o=Math.round(o/2),a=Math.round(a/2)}var d=y["d"];this.highPassUniforms=n["UniformsUtils"].clone(d.uniforms),this.highPassUniforms["luminosityThreshold"].value=i,this.highPassUniforms["smoothWidth"].value=.01,this.materialHighPassFilter=new n["ShaderMaterial"]({uniforms:this.highPassUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var p=[3,5,7,9,11];o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let u=0;u<this.nMips;u++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(p[u])),this.separableBlurMaterials[u].uniforms["texSize"].value=new n["Vector2"](o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms["blurTexture1"].value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms["blurTexture2"].value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms["blurTexture3"].value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms["blurTexture4"].value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms["blurTexture5"].value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms["bloomStrength"].value=t,this.compositeMaterial.uniforms["bloomRadius"].value=.1,this.compositeMaterial.needsUpdate=!0;var m=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms["bloomFactors"].value=m,this.bloomTintColors=[new n["Vector3"](1,1,1),new n["Vector3"](1,1,1),new n["Vector3"](1,1,1),new n["Vector3"](1,1,1),new n["Vector3"](1,1,1)],this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors;var f=y["b"];this.copyUniforms=n["UniformsUtils"].clone(f.uniforms),this.copyUniforms["opacity"].value=1,this.materialCopy=new n["ShaderMaterial"]({uniforms:this.copyUniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,blending:n["AdditiveBlending"],depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new n["Color"],this.oldClearAlpha=1,this.basic=new n["MeshBasicMaterial"],this.fsQuad=new u(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;++e)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;++e)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){var r=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(var s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(r,i),this.renderTargetsVertical[s].setSize(r,i),this.separableBlurMaterials[s].uniforms["texSize"].value=new n["Vector2"](r,i),r=Math.round(r/2),i=Math.round(i/2)}render(e,t,r,i,s){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),s&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms["tDiffuse"].value=r.texture,this.highPassUniforms["luminosityThreshold"].value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);const a=new n["Vector2"](1,0),c=new n["Vector2"](0,1);for(var h=this.renderTargetBright,l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms["colorTexture"].value=h.texture,this.separableBlurMaterials[l].uniforms["direction"].value=a,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms["colorTexture"].value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms["direction"].value=c,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),h=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms["bloomStrength"].value=this.strength,this.compositeMaterial.uniforms["bloomRadius"].value=this.radius,this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms["tDiffuse"].value=this.renderTargetsHorizontal[0].texture,s&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}getSeperableBlurMaterial(e){return new n["ShaderMaterial"]({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new n["Vector2"](.5,.5)},direction:{value:new n["Vector2"](.5,.5)}},...y["e"]})}getCompositeMaterial(e){return new n["ShaderMaterial"]({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},...y["f"]})}}class v{constructor(e,t){if(this.renderer=e,void 0===t){const r={minFilter:n["LinearFilter"],magFilter:n["LinearFilter"],format:n["RGBAFormat"],stencilBuffer:!1},i=e.getSize(new n["Vector2"]);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,t=new n["WebGLRenderTarget"](this._width*this._pixelRatio,this._height*this._pixelRatio,r),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new f(y["b"]),this.clock=new n["Clock"]}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e);const t=this.renderer.getDrawingBufferSize(new n["Vector2"]);e.setSize(t.width,t.height)}insertPass(e,t){this.passes.splice(t,0,e)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;++t)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r,n,i=!1,s=this.passes.length;for(n=0;n<s;++n)if(r=this.passes[n],!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),r.needsSwap){if(i){const t=this.renderer.context;t.stencilFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),t.stencilFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}r instanceof d?i=!0:r instanceof p&&(i=!1)}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new n["Vector2"]);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(let i=0;i<this.passes.length;++i)this.passes[i].setSize(r,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}var b=r("f7dd"),x=r("6c18"),w=r("f9e9");function P(e){for(const t of e.children)t.layers=e.layers;return e}function S(e){const t=!0,r=e.$refs.canvas,c=1,l=1,u=new n["PerspectiveCamera"](70,c/l,.01,1e3);u.position.set(12,4,12);const d=new n["AudioListener"];u.add(d);const p=new n["Scene"],S=new a(u);S.maxDistance=100,S.minDistance=14,S.maxPolarAngle=.4*Math.PI,S.enableKeys=!1,S.enablePan=!1,S.target.set(8,0,8),S.autoRotate=!0,C.threejsControls=S;const T=new o;T.layers.enable(1),T.scale.setScalar(990);const M=T.material.uniforms;C.skyUniforms=M,M.sunPosition.value.y=10,p.add(T);const z=new n["CubeCamera"](1,1e3,256);P(z),z.layers.set(1),z.renderTarget.texture.generateMipmaps=!0,z.renderTarget.texture.minFilter=n["LinearMipMapLinearFilter"],p.add(z);const E=new n["CubeTextureLoader"];E.setPath("statics/textures/env/testenv0/");const k=new n["MeshStandardMaterial"]({color:16777215,metalness:.8,roughness:.2,envMap:z.renderTarget.texture});let D;const O=new s["a"];O.load("statics/DeltaArrow.glb",e=>{D=e.scene.children[0],D.material=k,D.scale.multiplyScalar(.2)},void 0,console.error);const j=r.getContext("webgl2"),H=new n["WebGLRenderer"]({canvas:r,context:j,antialias:!1});H.autoClear=!1,H.shadowMap.enabled=!0,H.setSize(c,l),H.toneMappingExposure=Math.pow(1.1,4);const A=new m(p,u),V=new b["a"](window.innerWidth*H.getPixelRatio(),window.innerHeight*H.getPixelRatio()),K=new f(x["a"]),B=new w["a"](p,u),R=new g(new n["Vector2"](window.innerWidth,window.innerHeight),10,0,0),I=new v(H);I.renderToScreen=!1,I.addPass(A),I.addPass(R);const L=new f(new n["ShaderMaterial"]({uniforms:{baseTexture:{value:null},bloomTexture:{value:I.renderTarget2.texture}},vertexShader:y["a"].vertexShader,fragmentShader:y["a"].fragmentShader}),"baseTexture");let U;L.needsSwap=!0,C.changeAntialiasMode=e=>{switch(U=new v(H),U.addPass(A),e){case"fxaa":U.addPass(K);break;case"ssaa":U.addPass(B);break}switch(U.addPass(L),e){case"smaa":U.addPass(V);break}},C.changeAntialiasMode(C.antialiasMode);const N=new n["MeshBasicMaterial"]({color:"black"}),F=C.preAnimateFuncs;e.$onResize.push(({width:e,height:t})=>{u.aspect=e/t,u.updateProjectionMatrix(),H.setSize(e,t),I.setSize(e,t),U.setSize(e,t)}),e.$isDestroyed=!1;const _=new h.a;_.dom.style.cssText="";const G=e.$parent.$parent.$parent.$refs.toolbarStats;function Z(){if(e.$isDestroyed)return;requestAnimationFrame(Z),i["update"]();for(const e of F)e();C.game&&C.game.turnTimer&&C.game.turnTimer.getElapsedTime();const r=25e-6*(new Date).getTime(),n=15e-6*(new Date).getTime(),s=100*Math.cos(n);M.sunPosition.value.x=s*Math.cos(r),M.sunPosition.value.z=s*Math.sin(r),S&&S.update(),t&&(z.update(H,p),p.traverseVisible(e=>{e.isMesh?e.bloom||(e.tmp=e.material,e.material=N):e.tmp=!1}),T.visible=!1,I.render(),T.visible=!0,p.traverseVisible(e=>{e.tmp&&(e.material=e.tmp,e.tmp=void 0)}),U.render()),_.update()}return G.appendChild(_.dom),Z(),e.$deinit.push(()=>{e.$isDestroyed=!0,G.removeChild(_.dom),S&&S.dispose(),D&&(D.geometry.dispose(),D.material.dispose()),H.dispose()}),{scene:p,material:k,audioListener:d}}var T=r("49ca"),M=r("fd7d");r.d(t,"a",(function(){return C}));class z{constructor(){const e=[...Object.values(i["_tweens"])];for(const n of e)n.stop();const t=(e,t,r)=>{const n=localStorage.getItem(e);return null===n?t:r?r(n):n},r=e=>"true"===e;switch(this.darkMode=t("darkMode",!0,r),this.muteAudio=t("muteAudio",!1,r),this.masterVolume=t("masterVolume",100,parseInt),this.leftDrawerOpen=t("leftDrawerOpen",!0,r),this.rightDrawerOpen=t("rightDrawerOpen",!1,r),this.hostExpanded=t("hostExpanded",!1,r),this.joinExpanded=t("joinExpanded",!0,r),this.playerName=t("playerName",""),this.hostMatchName=t("hostMatchName",""),this.hostMaxPlayers=t("hostMaxPlayers",4,parseInt),this.hostSeed=t("hostSeed",""),this.hostEndTurnTimeLimit=t("hostEndTurnTimeLimit",15,parseInt),this.hostCheckpointCount=t("hostCheckpointCount",3,parseInt),this.hostHandSize=t("hostHandSize",8,parseInt),this.hostSlotCount=t("hostSlotCount",5,parseInt),this.antialiasMode=t("antialiasMode","none"),this.changeAntialiasMode=void 0,this.dialogData=void 0,this.antialiasMode){case"none":case"smaa":case"fxaa":case"ssaa":break;default:this.antialiasMode="none";break}this.game=new T["c"],this.cardSlots=[],this.hand=[],Object(M["a"])(this),this.dragged=void 0,this.threejsControls=void 0,this.skyUniforms=void 0,this.preAnimateFuncs=[]}init(e){const t=this.game;t.threeTest=S(e),t.scene=t.threeTest.scene,t.envMap=t.threeTest.material.envMap,t.audioListener=t.threeTest.audioListener,t.readyFunc=e=>{this.adjustPlayerSelf(),this.game.clock.start(),this.preAnimateFuncs.push(()=>{this.game.preAnimateFunc()})},t.asyncInit()}adjustPlayerSelf(){const e=this.game.match.playerSelf,t=this;t.cardSlots=e.bot.cardSlots,t.hand=e.hand}adjustAudioVolume(){this.game.audioListener&&this.game.audioListener.setMasterVolume(this.muteAudio?0:this.masterVolume/100)}}const C=new z;window.glos=C,window.game=C.game,window.THREE=n,window.TWEEN=i},ac93:function(e,t,r){"use strict";var n=r("9d97");const i=[...n["a"]],s=i.reduce((e,t)=>(e[t.key]=t,e),{});var o=r("5a89");r("ac6a"),r("0313");class a{constructor(e){this.tiMa=e,this.groundHeight=0,this.meshes=[]}remesh(e){for(const t of Object.values(this.tiMa.remesh()))t.castShadow=!0,t.receiveShadow=!0,this.meshes.push(t),e.add(t)}destroy(){for(const e of this.meshes)e.removeSelf()}getTiEnAt(e){const{dim:t,tiEns:r}=this.tiMa,n=(new o["Vector3"]).copy(e).floor();if(!t.check(n))return;const i=t.resolve(n);return r[i]}checkObstacle(e,t){const r=this.getTiEnAt(e);if(r)return r.entity!==t&&r.entity||r.tiTy.wall&&"wall"}enterBot(e,t){const r=this.getTiEnAt(e);r&&(r.visited=!0,void 0===r.entity&&r.entity!==t&&(r.entity=t,t&&t.tiEns.push(r)))}}class c{constructor(e){this.apiVersion=e}static createV0(e,t){const r=new c(0);return r.key=e,r.name=e,r.func=t,r}}var h=r("81d6");const l=[];function u(e,t,r){const{tiTys:n,match:i}=e,s=i.rngMapGen,a=t.tiMa,{dim:c,tiEns:l}=a,u=e=>s.choose(e),d=e=>s.chooseFrom(e),p=()=>new o["Vector3"](1+u(c.x-2),r,1+u(c.z-2)),m=["ConveyorSingle0","ConveyorDouble0","Wall0"],f=["X+","X-","Z+","Z-"],y={"X+":new o["Vector3"](1,0,0),"X-":new o["Vector3"](-1,0,0),"Z+":new o["Vector3"](0,0,1),"Z-":new o["Vector3"](0,0,-1)},g=20+Math.round(20*s.nextNumber());for(let P=0;P<g;++P){const e=d(m);let t=n[e];const r=1+u(4),i=p();for(let a=0;a<r;++a){if(0===i.x||0===i.z||i.x===c.x-1||i.z===c.z-1)break;const e=c.resolve(i),u=new h["b"](t),p=d(f);t.wall||(u.rotation=p),(!t.wall||a<r-1||s.nextNumber()>.2)&&(l[e]=u),t.wall&&(l[c.resolve(i.clone().add(new o["Vector3"](0,1,0)))]=new h["b"](n["Wall1"])),i.add(y[p])}}const v=(e,t)=>{const r=[new o["Vector3"](-1,0,0),new o["Vector3"](1,0,0),new o["Vector3"](0,0,-1),new o["Vector3"](0,0,1)];for(const n of r){const r=t.clone().add(n),i=l[c.resolve(r)];if(!i.tiTy.wall&&i.visited&&i.visited.groupIndex!==e.visited.groupIndex){let t,r;i.visited.groupIndex<e.visited.groupIndex?(t=i,r=e):(t=e,r=i);const n=t.visited,s=r.visited;for(const e of s.members)e.visited=n,n.members.includes(e)||n.members.push(e);return!0}}return!1};let b=0;for(let h=1;h<c.z-1;++h)for(let e=1;e<c.x-1;++e,++b){const t=new o["Vector3"](e,r,h),n=l[c.resolve(t)];n.tiTy.wall||(n.visited={groupIndex:b,members:[n]},v(n,t))}let x=[];for(let h=1;h<c.z-1;++h)for(let e=1;e<c.x-1;++e){const t=new o["Vector3"](e,r,h),n=l[c.resolve(t)];if(n.entity=t.clone(),!n.tiTy.wall){const e=n.visited;x.includes(e)||x.push(e)}}let w=!1;while(x.length>1){w=!1,x.sort((e,t)=>e.members.length===t.members.length?e.groupIndex-t.groupIndex:e.members.length-t.members.length),x[0].groupIndex=++b;const e=d(x[0].members).entity,t=d(x[x.length-1].members).entity,r=e.clone();for(const i of["x","z"]){if(w)break;while(r[i]!==t[i]){if(w)break;r[i]>t[i]?--r[i]:++r[i];const e=l[c.resolve(r)];if(e.tiTy.wall&&(e.tiTy=n["Pavement"],e.visited=x[0],x[0].members.push(e),v(e,r))){x.shift(),w=!0;break}}}}for(const o of x[0].members)o.visited=!1,o.entity=void 0}l.push(c.createV0("TestGen0",e=>{const{tiTys:t}=e,r=new h["a"](16),n=new h["c"](r),i=new a(n),s=2;i.groundHeight=s;const c=2;new o["Vector3"](r.x,s,r.z).iterXyz(e=>{let i=r.resolve(e);n.tiEns[i]=new h["b"](t["Ground"])}),new o["Vector3"](r.x,c,r.z).iterXyz(e=>{let i=r.resolve(new o["Vector3"](0,s,0).add(e));if(0===e.x||0===e.z||e.x===r.x-1||e.z===r.z-1){let r="Wall1";(0===e.x&&0===e.z||e.y<c-1&&(e.x+e.z)%3!==0)&&(r="Wall0"),n.tiEns[i]=new h["b"](t[r])}}),new o["Vector3"](r.x,1,r.z).iterXyz(e=>{let i=r.resolve(new o["Vector3"](0,s,0).add(e));0!==e.x&&0!==e.z&&e.x!==r.x-1&&e.z!==r.z-1&&(n.tiEns[i]=new h["b"](t["Pavement"]))});const l=new o["Vector3"](0,s+c,0);return n.tiEns[r.resolve(l)]=new h["b"](t["ControlTower0"]),u(e,i,s),{map:i,controlTowerTilePosition:l}}));const d=[...l],p=d.reduce((e,t)=>(e[t.key]=t,e),{});function m(e){const t={},r=(e,r)=>(t[r]=f(e,r),t[r]);for(const[i,s]of Object.entries(e))r(s,i);let n=r(e["Cube"],"Ground");n.color=new o["Vector4"](173/255,131/255,83/255,1),n.wall=!0,n=r(e["Floor0"],"Pavement"),n.color=new o["Vector4"](1,1,1,1);for(let i=0;i<=1;++i)t["Wall"+i].wall=!0;return t}function f(e,t){return y(new h["e"](e),t)}function y(e,t){return e.key=t,e.wall=!1,e}var g=r("49ca"),v=r("abf7");function b(e){const t=new g["d"](e);window.match=t,t.mapGen=p["TestGen0"],e.match=t,e.regenerateMap(!1),M(e),T(e,e.envMap),e.recreatePlayers()}function x(e,t){for(const r of i){const e=new g["a"](r);t.hand.push(e)}}function w(e,t){const{match:r}=e;r.playerSelf=void 0,r.players=[];for(let n=0;n<t;++n)P(e,"Player-"+(n+1));r.turnPlayers=[...r.players]}function P(e,t,r){const n=["robot","robot-industrial","tank","settings","face-agent","alien","laptop","desktop-classic","account-badge","account-card-details","pirate","target","target","target-variant","emoticon-devil"],{match:i,netMatch:s}=e,{players:o}=i;let a,c;if("string"===typeof t)for(c=t,t=void 0,a=0;a<o.length;++a)if(a<o[a].id)break;const h=new g["e"](e,a,c);return x(i,h),!t||t instanceof g["e"]||(h.id=t.id),a=h.id,h.icon=n[h.id%n.length],S(e,h.bot,a),!t||t instanceof g["e"]||h.deserialize(t),h.bot.resizeCardSlots(i.slotCount),o.push(h),o.sort((e,t)=>e.id-t.id),s&&(s.playerCount=o.length),void 0!==r&&h.cryptoKeySvPublicLoad(r),h}function S(e,t,r){const n=e.models["Bot"].clone(),i=n.children[0].material.clone(),s=i.color,a=[new o["Color"](1,1,0),new o["Color"](1,.25,0),new o["Color"](1,0,0),new o["Color"](.25,0,0),new o["Color"](1,1,1),new o["Color"](0,0,.25),new o["Color"](0,0,.5),new o["Color"](0,0,0),new o["Color"](0,1,0),new o["Color"](.75,.75,0),new o["Color"](.25,0,1)],c=a[r%a.length].multiplyScalar(2);t.guiColor.copy(c),s.add(c),n.traverseVisible(e=>{e.isMesh&&(e.material=i)}),t.object3d=n,t.directionKey="N",n.position.y=2,n.position.x=7,n.position.z=4+2*r;const h=e.models["lazor-orb"].clone();h.position.y=.07,h.position.z=.23,h.bloom=!0,t.lazorOrb=h,n.add(h);const l=new o["PositionalAudio"](e.audioListener);v["a"].adjustAudioVolume();const u=e.audioListener.context.createOscillator();u.type="square",u.frequency.setValueAtTime(6,l.context.currentTime),u.start(0),l.setNodeSource(u),l.setRefDistance(1),l.setVolume(.01),t.engineSound=l,t.engineSoundGen=u,n.add(l),e.scene.add(n)}function T(e,t){for(const r of Object.values(e.materials))r.envMap||(r.envMap=t);for(const r of Object.values(e.models))r.traverseVisible(e=>{e.isMesh&&(e.material.envMap=t)})}function M(e){const t=e.scene,r=new o["DirectionalLight"](16777215,1);r.position.set(-5,2,-5),r.castShadow=!0,r.shadow.mapSize.width=2048,r.shadow.mapSize.height=2048;const n=e.match.map.tiMa.dim,i=(new o["Vector3"]).copy(n).multiplyScalar(.5);r.shadow.camera.top=n.length(),r.shadow.camera.left=-Math.max(n.x,n.z),r.shadow.camera.right=-r.shadow.camera.left,r.target.position.copy(i),r.target.position.y=-.5*r.shadow.camera.top,t.add(r),t.add(r.target),v["a"].preAnimateFuncs.push(()=>{const t=v["a"].skyUniforms.sunPosition.value,n=r.position,i=e.match.map.tiMa.dim,s=(new o["Vector3"]).copy(i);s.y=0;const a=(new o["Vector3"]).copy(s).multiplyScalar(.5),c=(new o["Vector3"]).copy(t).normalize().multiplyScalar(i.length()).add(a);n.copy(c)})}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"g",(function(){return p})),r.d(t,"f",(function(){return m})),r.d(t,"e",(function(){return b})),r.d(t,"d",(function(){return w})),r.d(t,"c",(function(){return P}))},b217:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));class n{constructor(e,t,r){this.key=e,this.title=t,this.func=r}}},bf0e:function(e,t,r){"use strict";var n=r("3dcd");r.o(n,"BufferAttributeExt")&&r.d(t,"BufferAttributeExt",(function(){return n["BufferAttributeExt"]})),r.o(n,"BufferAttributeExtIndex")&&r.d(t,"BufferAttributeExtIndex",(function(){return n["BufferAttributeExtIndex"]}));var i=r("6291");r.o(i,"BufferAttributeExt")&&r.d(t,"BufferAttributeExt",(function(){return i["BufferAttributeExt"]})),r.o(i,"BufferAttributeExtIndex")&&r.d(t,"BufferAttributeExtIndex",(function(){return i["BufferAttributeExtIndex"]}));var s=r("0313");r.d(t,"BufferAttributeExt",(function(){return s["a"]})),r.d(t,"BufferAttributeExtIndex",(function(){return s["b"]}))},c380:function(e,t,r){"use strict";r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return p}));var n=r("5a89"),i=r("682a"),s=(r("0313"),r("fd7d")),o=r("9d97"),a=r("028a");const c="NESW",h={N:new n["Vector3"](1,0,0),S:new n["Vector3"](-1,0,0),E:new n["Vector3"](0,0,1),W:new n["Vector3"](0,0,-1)},l={N:.5*Math.PI,S:1.5*Math.PI,E:0*Math.PI,W:1*Math.PI},u={N:"x",S:"x",E:"z",W:"z"},d={"X+":"N","X-":"S","Z+":"E","Z-":"W"};class p{constructor(e,t){this.alive=!0,this.health=1,this.towerDistance=-1,Object(s["a"])(this),this.game=e,this.player=t,this.cardSlots=[],this.cardIndex=0,this.tiEns=[],this.guiColor=new n["Color"](1,1,1),this.engineSound=void 0,this.engineSoundGen=void 0,this.lazorOrb=void 0,this._object3d=void 0,this._directionKey="N"}get object3d(){return this._object3d}set object3d(e){this._object3d=e,this.applyDirectionKeyToObject3d()}get directionAxis(){return u[this.directionKey]}get directionKey(){return this._directionKey}set directionKey(e){this._directionKey=e,this.applyDirectionKeyToObject3d()}applyDirectionKeyToObject3d(){const{object3d:e}=this;e&&e.setRotationFromAxisAngle(new n["Vector3"](0,1,0),l[this.directionKey])}get direction(){return h[this.directionKey]}rotate(e,t=!0){const r=c.indexOf(this.directionKey);let s=(r+e)%c.length;if(s<0&&(s+=c.length),t){this.engineSound.setVolume(1);const t={angle:l[this.directionKey]};this._directionKey=c[s];const r={angle:t.angle-.5*e*Math.PI};new i["Tween"](t).to(r,1e3).easing(m).onUpdate(()=>{this.object3d.setRotationFromAxisAngle(new n["Vector3"](0,1,0),t.angle)}).onComplete(()=>{this.engineSound.setVolume(.01),this.cardDone()}).start()}else this.directionKey=c[s]}resizeCardSlots(e){const{cardSlots:t}=this;t.splice(e,t.length-e);for(let r=t.length;r<e;++r)t.push(new a["a"])}invokeCardSlot(e){this.cardIndex=e;const t=this.cardSlots[e];return!(!t||!t.invoke(this))}cardDone(){const e=this.cardSlots[this.cardIndex];e&&(e.active=!1),this.game.match.progressTurn()}enterOnMap(e=!1){const{match:t,sfxf:r}=this.game,{map:n,controlTower:i}=t,s=this.object3d.position;if(n.enterBot(s,this),this.towerDistance=i.position.distanceTo(s.clone().floor().addScalar(.5)),e){const e=this.player.completedCheckpoints;t.checkpoints[e].checkPosition.equals(s.clone().floor())&&(++this.player.completedCheckpoints,this.health+=2*t.damageLazor,this.health>1&&(this.health=1),this.object3d.add(r.cpasCheckpoint()),this.player.completedCheckpoints===t.checkpointCount&&this.player.win("checkpoint"))}}cleanupVisitedTiles(){this.tiEns=this.tiEns.filter(e=>{const t=e.visited;return e.visited=!1,!!t||(e.entity=void 0,!1)})}conveyor(){const e=this.game,t=e.match,r=t.map,n=this.object3d.position,i=r.getTiEnAt(n),s=i.tiTy,a={ConveyorSingle0:1,ConveyorDouble0:2},c="number"===typeof a[s.key]?a[s.key]:0;if(c>0){this.hoverEffect(!0);const e=d[i.rotation];Object(o["b"])(this,c,e,()=>t.actionDone())}else t.actionDone()}hoverEffect(e=!1){const t=this.game,r=this.object3d.children[0].children[1].children[0];if("Tracks"!==r.name)return void console.warn('Bot conveyor glow - "Tracks" are not at the expected place');const n=!!r.hovering;e!==n&&(e?(r.bloom=!0,r.hovering=r.material,r.material=t.materials["Hover"]):(r.bloom=!1,r.material=r.hovering,r.hovering=void 0))}shoot(){const e=this.game.match,t=e.map,r=this.object3d.position,s=r.clone().floor();while(1){s.add(this.direction);const r=t.getTiEnAt(s);if(!r||r.tiTy.wall)return void e.actionDone();if(r.entity){const t=this.lazorOrb,s=t.position,o=t.position.clone(),a=t.getWorldPosition(new n["Vector3"]);this.game.scene.add(t),s.copy(a);const c=r.entity,h=c.object3d.position.clone().floor();return t.add(this.game.sfxf.cpasShoot()),void new i["Tween"](s).to(h,125*s.distanceTo(h)).onComplete(()=>{c.damage("lazor",this.player),this.object3d.add(t),s.copy(o),e.actionDone()}).start()}}}damageFlash(e=100){const{object3d:t}=this;t.traverseVisible(e=>{e.isMesh&&!e.bloom&&(e.bloom="tmp")}),new i["Tween"]({}).to({},e).onComplete(()=>{t.traverseVisible(e=>{"tmp"===e.bloom&&(e.bloom=!1)})}).start()}highlight(){this.damageFlash(2e3)}damage(e,t){if(!this.alive)return void this.player.markAsDead(t);const{game:r,object3d:n}=this,{match:i,sfxf:s}=r;let o=0;switch(e){case"lazor":o=i.damageLazor,n.add(s.cpasHit()),this.damageFlash();break;case"shove":o=i.damageShove,n.add(s.cpasShove());break;case"crush":o=i.damageCrush,n.add(s.cpasCrush());break}return this.health-=o,this.health<Number.EPSILON&&this.explode(t)}explode(e){if(!this.player.markAsDead(e))return!1;this.alive=!1,this.health=0;const t=this.game.sfxf.cpasExplode();return t.position.copy(this.object3d.position),this.game.scene.add(t),this.game.createExplosion().position.copy(this.object3d.position),this.destroy(),!0}clearCardSlots(){for(const e of this.cardSlots)e.clear()}clearTiEns(){for(const e of this.tiEns)e.entity=void 0;this.tiEns=[]}destroy(e=!0){this.clearTiEns(),this.towerDistance=-1,this.clearCardSlots(),this.engineSoundGen.stop(),e&&this.object3d.removeSelf()}serialize(){return{health:this.health,position:this.object3d&&this.object3d.position.serialize(),directionKey:this.directionKey,cardSlots:this.cardSlots.map(e=>e.serialize())}}deserialize(e){const{health:t,position:r,directionKey:n,cardSlots:i}=e;if(void 0!==t){const e=this.health;this.health=t,e>=Number.EPSILON&&this.health<Number.EPSILON&&(this.alive=!1,this.destroy())}void 0!==r&&this.object3d&&this.object3d.position.copy(r),void 0!==n&&(this.directionKey=n),void 0!==i&&(this.cardSlots=i.map(e=>(new a["a"]).deserialize(e)))}}function m(e){const t=.5,r=2.5949095*t;return(e*=2)<1?e*e*((r+1)*e-r)*.5:.5*((e-=2)*e*((r+1)*e+r)+2)}},d014:function(e,t,r){"use strict";var n=r("5a89");n["Object3D"].prototype.traverseControlled=function(e){if(!e(this))return;const t=this.children;for(let r=0,n=t.length;r<n;++r)t[r].traverseControlled(e)},n["Object3D"].prototype.removeSelf=function(){this.parent&&this.parent.remove(this)}},d328:function(e,t,r){"use strict";var n="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/shaders/CopyShader.js\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\r\n}\r\n",i="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/shaders/CopyShader.js\r\n\r\nuniform float opacity;\r\n\r\nuniform sampler2D tDiffuse;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n  vec4 texel = texture2D( tDiffuse, vUv );\r\n  gl_FragColor = opacity * texel;\r\n\r\n}\r\n";const s={vertexShader:n,fragmentShader:i,uniforms:{tDiffuse:{value:null},opacity:{value:1}}};var o=r("5a89"),a="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/shaders/LuminosityHighPassShader.js\r\n\r\nvarying vec2 vUv;\r\n\r\n\t\tvoid main() {\r\n\r\n\t\t\tvUv = uv;\r\n\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\r\n}\r\n",c="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/shaders/LuminosityHighPassShader.js\r\n\r\nuniform sampler2D tDiffuse;\r\nuniform vec3 defaultColor;\r\nuniform float defaultOpacity;\r\nuniform float luminosityThreshold;\r\nuniform float smoothWidth;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n  vec4 texel = texture2D( tDiffuse, vUv );\r\n\r\n  vec3 luma = vec3( 0.299, 0.587, 0.114 );\r\n\r\n  float v = dot( texel.xyz, luma );\r\n\r\n  vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\r\n\r\n  float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\r\n\r\n  gl_FragColor = mix( outputColor, texel, alpha );\r\n\r\n}\r\n";const h={vertexShader:a,fragmentShader:c,uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new o["Color"](0)},defaultOpacity:{type:"f",value:0}}};var l="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/postprocessing/UnrealBloomPass.js\r\n\r\nvarying vec2 vUv;\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n",u="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/postprocessing/UnrealBloomPass.js\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D colorTexture;\r\nuniform vec2 texSize;\r\nuniform vec2 direction;\r\n\r\nfloat gaussianPdf(in float x, in float sigma) {\r\n  return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\r\n}\r\nvoid main() {\r\n  vec2 invSize = 1.0 / texSize;\r\n  float fSigma = float(SIGMA);\r\n  float weightSum = gaussianPdf(0.0, fSigma);\r\n  vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\r\n  for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\r\n    float x = float(i);\r\n    float w = gaussianPdf(x, fSigma);\r\n    vec2 uvOffset = direction * invSize * x;\r\n    vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\r\n    vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\r\n    diffuseSum += (sample1 + sample2) * w;\r\n    weightSum += 2.0 * w;\r\n  }\r\n  gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\r\n}\r\n";const d={vertexShader:l,fragmentShader:u};var p="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/postprocessing/UnrealBloomPass.js\r\n\r\nvarying vec2 vUv;\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n",m="// Part of a slightly modified version of the original https://github.com/mrdoob/three.js/blob/eaa4f9dc511d3091443069db0f9c74093e29f943/examples/js/postprocessing/UnrealBloomPass.js\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D blurTexture1;\r\nuniform sampler2D blurTexture2;\r\nuniform sampler2D blurTexture3;\r\nuniform sampler2D blurTexture4;\r\nuniform sampler2D blurTexture5;\r\nuniform sampler2D dirtTexture;\r\nuniform float bloomStrength;\r\nuniform float bloomRadius;\r\nuniform float bloomFactors[NUM_MIPS];\r\nuniform vec3 bloomTintColors[NUM_MIPS];\r\n\r\nfloat lerpBloomFactor(const in float factor) {\r\n  float mirrorFactor = 1.2 - factor;\r\n  return mix(factor, mirrorFactor, bloomRadius);\r\n}\r\n\r\nvoid main() {\r\n  gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\r\n                    lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\r\n                    lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\r\n                    lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\r\n                    lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\r\n}\r\n";const f={vertexShader:p,fragmentShader:m};var y="// Part of a slightly modified version of the original\r\n// https://github.com/mrdoob/three.js/blob/159a40648ee86755220491d4f0bae202235a341c/examples/webgl_postprocessing_unreal_bloom_selective.html\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}\r\n",g="// Part of a slightly modified version of the original\r\n// https://github.com/mrdoob/three.js/blob/159a40648ee86755220491d4f0bae202235a341c/examples/webgl_postprocessing_unreal_bloom_selective.html\r\n\r\nuniform sampler2D baseTexture;\r\nuniform sampler2D bloomTexture;\r\nvarying vec2 vUv;\r\n\r\nvec4 getTexture(sampler2D texelToLinearTexture) {\r\n  return mapTexelToLinear(texture2D(texelToLinearTexture, vUv));\r\n}\r\n\r\nvoid main() {\r\n  gl_FragColor =\r\n      (getTexture(baseTexture) + vec4(1.0) * getTexture(bloomTexture));\r\n}\r\n";const v={vertexShader:y,fragmentShader:g,uniforms:{baseTexture:{value:null},bloomTexture:{value:null}}};var b='// Part of a slightly modified version of the original\r\n// https://github.com/spite/vertex-displacement-noise-3d-webgl-glsl-three-js/tree/3ee8c6eb34eb1d4a8a3ccf5743c358c1c8c1b58c\r\n\r\n//\r\n// GLSL textureless classic 3D noise "cnoise",\r\n// with an RSL-style periodic variant "pnoise".\r\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\r\n// Version: 2011-10-11\r\n//\r\n// Many thanks to Ian McEwan of Ashima Arts for the\r\n// ideas for permutation and gradient selection.\r\n//\r\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\r\n// Distributed under the MIT license. See LICENSE file.\r\n// https://github.com/ashima/webgl-noise\r\n//\r\n\r\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\r\n\r\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\r\n\r\nvec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\r\n\r\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\r\n\r\nvec3 fade(vec3 t) { return t * t * t * (t * (t * 6.0 - 15.0) + 10.0); }\r\n\r\n// Classic Perlin noise\r\nfloat cnoise(vec3 P) {\r\n  vec3 Pi0 = floor(P);        // Integer part for indexing\r\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\r\n  Pi0 = mod289(Pi0);\r\n  Pi1 = mod289(Pi1);\r\n  vec3 Pf0 = fract(P);        // Fractional part for interpolation\r\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\r\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\r\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\r\n  vec4 iz0 = Pi0.zzzz;\r\n  vec4 iz1 = Pi1.zzzz;\r\n\r\n  vec4 ixy = permute(permute(ix) + iy);\r\n  vec4 ixy0 = permute(ixy + iz0);\r\n  vec4 ixy1 = permute(ixy + iz1);\r\n\r\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\r\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\r\n  gx0 = fract(gx0);\r\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\r\n  vec4 sz0 = step(gz0, vec4(0.0));\r\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\r\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\r\n\r\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\r\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\r\n  gx1 = fract(gx1);\r\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\r\n  vec4 sz1 = step(gz1, vec4(0.0));\r\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\r\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\r\n\r\n  vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\r\n  vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\r\n  vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\r\n  vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\r\n  vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\r\n  vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\r\n  vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\r\n  vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\r\n\r\n  vec4 norm0 = taylorInvSqrt(\r\n      vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\r\n  g000 *= norm0.x;\r\n  g010 *= norm0.y;\r\n  g100 *= norm0.z;\r\n  g110 *= norm0.w;\r\n  vec4 norm1 = taylorInvSqrt(\r\n      vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\r\n  g001 *= norm1.x;\r\n  g011 *= norm1.y;\r\n  g101 *= norm1.z;\r\n  g111 *= norm1.w;\r\n\r\n  float n000 = dot(g000, Pf0);\r\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\r\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\r\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\r\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\r\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\r\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\r\n  float n111 = dot(g111, Pf1);\r\n\r\n  vec3 fade_xyz = fade(Pf0);\r\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111),\r\n                 fade_xyz.z);\r\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\r\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\r\n  return 2.2 * n_xyz;\r\n}\r\n\r\n// Classic Perlin noise, periodic variant\r\nfloat pnoise(vec3 P, vec3 rep) {\r\n  vec3 Pi0 = mod(floor(P), rep);        // Integer part, modulo period\r\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\r\n  Pi0 = mod289(Pi0);\r\n  Pi1 = mod289(Pi1);\r\n  vec3 Pf0 = fract(P);        // Fractional part for interpolation\r\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\r\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\r\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\r\n  vec4 iz0 = Pi0.zzzz;\r\n  vec4 iz1 = Pi1.zzzz;\r\n\r\n  vec4 ixy = permute(permute(ix) + iy);\r\n  vec4 ixy0 = permute(ixy + iz0);\r\n  vec4 ixy1 = permute(ixy + iz1);\r\n\r\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\r\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\r\n  gx0 = fract(gx0);\r\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\r\n  vec4 sz0 = step(gz0, vec4(0.0));\r\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\r\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\r\n\r\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\r\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\r\n  gx1 = fract(gx1);\r\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\r\n  vec4 sz1 = step(gz1, vec4(0.0));\r\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\r\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\r\n\r\n  vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\r\n  vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\r\n  vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\r\n  vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\r\n  vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\r\n  vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\r\n  vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\r\n  vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\r\n\r\n  vec4 norm0 = taylorInvSqrt(\r\n      vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\r\n  g000 *= norm0.x;\r\n  g010 *= norm0.y;\r\n  g100 *= norm0.z;\r\n  g110 *= norm0.w;\r\n  vec4 norm1 = taylorInvSqrt(\r\n      vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\r\n  g001 *= norm1.x;\r\n  g011 *= norm1.y;\r\n  g101 *= norm1.z;\r\n  g111 *= norm1.w;\r\n\r\n  float n000 = dot(g000, Pf0);\r\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\r\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\r\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\r\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\r\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\r\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\r\n  float n111 = dot(g111, Pf1);\r\n\r\n  vec3 fade_xyz = fade(Pf0);\r\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111),\r\n                 fade_xyz.z);\r\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\r\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\r\n  return 2.2 * n_xyz;\r\n}\r\n\r\n// - //\r\n\r\nvarying vec2 vUv;\r\nvarying float noise;\r\nuniform float time;\r\n\r\nfloat turbulence(vec3 p) {\r\n  float w = 100.0;\r\n  float t = -.5;\r\n  for (float f = 1.0; f <= 10.0; f++) {\r\n    float power = pow(2.0, f);\r\n    t += abs(pnoise(vec3(power * p), vec3(10.0, 10.0, 10.0)) / power);\r\n  }\r\n  return t;\r\n}\r\n\r\nvoid main() {\r\n\r\n  vUv = uv;\r\n\r\n  noise = 10.0 * -.10 * turbulence(.5 * normal + time);\r\n  float b = 5.0 * pnoise(0.05 * position + vec3(2.0 * time), vec3(100.0));\r\n  float displacement = -10. * noise + b;\r\n\r\n  vec3 newPosition = position + normal * displacement;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\r\n}\r\n',x="// Part of a slightly modified version of the original\r\n// https://github.com/spite/vertex-displacement-noise-3d-webgl-glsl-three-js/tree/3ee8c6eb34eb1d4a8a3ccf5743c358c1c8c1b58c\r\n\r\nvarying vec2 vUv;\r\nvarying float noise;\r\nuniform sampler2D tExplosion;\r\n\r\nfloat random(vec3 scale, float seed) {\r\n  return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\r\n}\r\n\r\nvoid main() {\r\n  float r = .01 * random(vec3(12.9898, 78.233, 151.7182), 0.0);\r\n  vec2 tPos = vec2(0, 1.3 * noise + r);\r\n  vec4 color = texture2D(tExplosion, tPos);\r\n  gl_FragColor = vec4(color.rgb, 1.0);\r\n}\r\n";const w={vertexShader:b,fragmentShader:x,uniforms:{tExplosion:{type:"t",value:null},time:{type:"f",value:0}}};r.d(t,"b",(function(){return s})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return f})),r.d(t,"a",(function(){return v})),r.d(t,"c",(function(){return w}))},fd7d:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("2b0e");const i=(new n["a"]).$data.__ob__.constructor;new i({});function s(e){return new i(e)}}}]);